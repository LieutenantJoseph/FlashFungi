<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arizona Mushroom Study - Admin Portal</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="admin-root">
        <div style="padding: 20px; text-align: center;">
            <h1>Loading Admin Portal...</h1>
            <p>If this message persists, there may be a JavaScript error.</p>
        </div>
    </div>

    <script type="text/babel">
        console.log('üî• Admin portal script starting...');
        
        // Check React availability
        if (typeof React === 'undefined') {
            console.error('‚ùå React not available');
            document.getElementById('admin-root').innerHTML = '<div style="padding: 20px; color: red;"><h1>Error: React not loaded</h1></div>';
        } else {
            console.log('‚úÖ React available');
        }

        const { useState, useEffect } = React;
        
        // Configuration
        const SUPABASE_URL = 'https://oxgedcncrettasrbmwsl.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im94Z2VkY25jcmV0dGFzcmJtd3NsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5MDY4NjQsImV4cCI6MjA2OTQ4Mjg2NH0.mu0Cb6qRr4cja0vsSzIuLwDTtNFuimWUwNs_JbnO3Pg';

        function AdminPortal() {
            console.log('üèóÔ∏è AdminPortal component rendering');
            
            const [currentView, setCurrentView] = useState('dashboard');
            const [specimens, setSpecimens] = useState([]);
            const [loading, setLoading] = useState(true);
            const [stats, setStats] = useState({});

            useEffect(() => {
                console.log('üîÑ useEffect triggered');
                loadData();
            }, []);

            const loadData = async () => {
                try {
                    console.log('üìä Loading specimens data...');
                    const response = await fetch(`${SUPABASE_URL}/rest/v1/specimens?select=*&order=created_at.desc`, {
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    console.log(`‚úÖ Loaded ${data.length} specimens`);
                    setSpecimens(data || []);

                    // Calculate stats
                    const pending = data.filter(s => s.status === 'pending').length;
                    const approved = data.filter(s => s.status === 'approved').length;
                    const dnaVerified = data.filter(s => s.dna_sequenced).length;
                    
                    setStats({
                        total: data.length,
                        pending,
                        approved,
                        rejected: data.filter(s => s.status === 'rejected').length,
                        dnaVerified
                    });

                } catch (error) {
                    console.error('‚ùå Error loading data:', error);
                } finally {
                    setLoading(false);
                }
            };

            if (loading) {
                return React.createElement('div', {
                    className: 'min-h-screen bg-gray-50 flex items-center justify-center'
                }, 
                    React.createElement('div', { className: 'text-center' },
                        React.createElement('div', { className: 'text-6xl mb-4' }, 'üõ°Ô∏è'),
                        React.createElement('h1', { className: 'text-2xl font-bold text-gray-800 mb-2' }, 'Admin Portal'),
                        React.createElement('p', { className: 'text-gray-600' }, 'Loading data...')
                    )
                );
            }

            return React.createElement('div', { className: 'min-h-screen bg-gray-50' },
                React.createElement(AdminHeader, { stats }),
                React.createElement(AdminNavigation, { currentView, setCurrentView }),
                React.createElement('main', { className: 'max-w-7xl mx-auto px-4 py-8' },
                    currentView === 'dashboard' && React.createElement(Dashboard, { stats, specimens }),
                    currentView === 'review' && React.createElement(ReviewQueue, { specimens: specimens.filter(s => s.status === 'pending') }),
                    currentView === 'approved' && React.createElement(ApprovedSpecimens, { specimens: specimens.filter(s => s.status === 'approved') }),
                    currentView === 'all' && React.createElement(AllSpecimens, { specimens })
                )
            );
        }

        function AdminHeader({ stats }) {
            return React.createElement('div', { className: 'bg-slate-800 text-white' },
                React.createElement('div', { className: 'max-w-7xl mx-auto px-4 py-4' },
                    React.createElement('div', { className: 'flex justify-between items-center' },
                        React.createElement('div', { className: 'flex items-center gap-3' },
                            React.createElement('div', { className: 'text-3xl' }, 'üõ°Ô∏è'),
                            React.createElement('div', null,
                                React.createElement('h1', { className: 'text-xl font-bold' }, 'Admin Portal'),
                                React.createElement('p', { className: 'text-slate-300 text-sm' }, 'Arizona Mushroom Study')
                            )
                        ),
                        React.createElement('div', { className: 'flex items-center gap-6' },
                            React.createElement('div', { className: 'text-center' },
                                React.createElement('div', { className: 'text-2xl font-bold text-orange-400' }, stats.pending || 0),
                                React.createElement('div', { className: 'text-xs text-slate-300' }, 'Pending')
                            ),
                            React.createElement('div', { className: 'text-center' },
                                React.createElement('div', { className: 'text-2xl font-bold text-green-400' }, stats.approved || 0),
                                React.createElement('div', { className: 'text-xs text-slate-300' }, 'Approved')
                            ),
                            React.createElement('div', { className: 'text-center' },
                                React.createElement('div', { className: 'text-2xl font-bold text-blue-400' }, stats.dnaVerified || 0),
                                React.createElement('div', { className: 'text-xs text-slate-300' }, 'DNA Verified')
                            )
                        )
                    )
                )
            );
        }

        function AdminNavigation({ currentView, setCurrentView }) {
            const navItems = [
                { id: 'dashboard', label: 'Dashboard', icon: 'üìä' },
                { id: 'review', label: 'Review Queue', icon: '‚è≥' },
                { id: 'approved', label: 'Approved', icon: '‚úÖ' },
                { id: 'all', label: 'All Specimens', icon: 'üîß' }
            ];

            return React.createElement('div', { className: 'bg-white border-b shadow-sm' },
                React.createElement('div', { className: 'max-w-7xl mx-auto px-4' },
                    React.createElement('div', { className: 'flex gap-6' },
                        ...navItems.map(item =>
                            React.createElement('button', {
                                key: item.id,
                                onClick: () => setCurrentView(item.id),
                                className: `flex items-center gap-2 px-4 py-4 border-b-2 transition-colors ${
                                    currentView === item.id 
                                        ? 'border-green-500 text-green-600' 
                                        : 'border-transparent text-gray-600 hover:text-gray-800'
                                }`
                            },
                                React.createElement('span', null, item.icon),
                                item.label
                            )
                        )
                    )
                )
            );
        }

        function Dashboard({ stats, specimens }) {
            const recentSpecimens = specimens.slice(0, 5);

            return React.createElement('div', { className: 'space-y-6' },
                React.createElement('div', { className: 'grid md:grid-cols-4 gap-6' },
                    React.createElement(StatCard, { title: 'Total Specimens', value: stats.total, color: 'text-blue-600' }),
                    React.createElement(StatCard, { title: 'Pending Review', value: stats.pending, color: 'text-orange-600' }),
                    React.createElement(StatCard, { title: 'Approved', value: stats.approved, color: 'text-green-600' }),
                    React.createElement(StatCard, { title: 'DNA Verified', value: stats.dnaVerified, color: 'text-purple-600' })
                ),
                React.createElement('div', { className: 'bg-white rounded-xl p-6 shadow-sm' },
                    React.createElement('h3', { className: 'text-lg font-semibold mb-4' }, 'Recent Specimens'),
                    React.createElement('div', { className: 'space-y-3' },
                        ...recentSpecimens.map(specimen =>
                            React.createElement('div', {
                                key: specimen.id,
                                className: 'flex items-center justify-between p-3 bg-gray-50 rounded-lg'
                            },
                                React.createElement('div', null,
                                    React.createElement('h4', { className: 'font-medium' }, specimen.species_name),
                                    React.createElement('p', { className: 'text-sm text-gray-600' }, specimen.location)
                                ),
                                React.createElement('div', { className: 'flex items-center gap-2' },
                                    React.createElement(StatusBadge, { status: specimen.status }),
                                    specimen.dna_sequenced && React.createElement('span', {
                                        className: 'text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded'
                                    }, 'DNA')
                                )
                            )
                        )
                    )
                )
            );
        }

        function ReviewQueue({ specimens }) {
            if (specimens.length === 0) {
                return React.createElement('div', { className: 'text-center py-12' },
                    React.createElement('div', { className: 'text-6xl mb-4' }, 'üéâ'),
                    React.createElement('h3', { className: 'text-2xl font-bold mb-2' }, 'All Caught Up!'),
                    React.createElement('p', { className: 'text-gray-600' }, 'No specimens pending review.')
                );
            }

            return React.createElement('div', { className: 'space-y-4' },
                React.createElement('div', { className: 'flex justify-between items-center' },
                    React.createElement('h2', { className: 'text-2xl font-bold' }, 'Review Queue'),
                    React.createElement('p', { className: 'text-gray-600' }, `${specimens.length} specimens pending`)
                ),
                React.createElement('div', { className: 'grid gap-6' },
                    ...specimens.map(specimen =>
                        React.createElement('div', {
                            key: specimen.id,
                            className: 'bg-white rounded-xl shadow-sm p-6'
                        },
                            React.createElement('div', { className: 'flex justify-between items-start mb-4' },
                                React.createElement('div', null,
                                    React.createElement('h3', { className: 'text-lg font-semibold' }, specimen.species_name),
                                    React.createElement('p', { className: 'text-gray-600' }, specimen.common_name || 'No common name'),
                                    React.createElement('p', { className: 'text-sm text-gray-500' }, specimen.location)
                                ),
                                React.createElement('div', { className: 'flex items-center gap-2' },
                                    React.createElement(StatusBadge, { status: specimen.status }),
                                    specimen.dna_sequenced && React.createElement('span', {
                                        className: 'bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs font-medium'
                                    }, 'DNA Verified'),
                                    React.createElement('button', {
                                        className: 'bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors',
                                        onClick: () => alert(`Review functionality for ${specimen.species_name} - Coming soon!`)
                                    }, 'Review')
                                )
                            ),
                            React.createElement('div', { className: 'grid md:grid-cols-4 gap-2 mb-4' },
                                React.createElement('div', { className: 'text-sm' },
                                    React.createElement('strong', null, 'Family: '), specimen.family
                                ),
                                React.createElement('div', { className: 'text-sm' },
                                    React.createElement('strong', null, 'Habitat: '), 
                                    specimen.habitat?.substring(0, 50) + (specimen.habitat?.length > 50 ? '...' : '')
                                ),
                                React.createElement('div', { className: 'text-sm' },
                                    React.createElement('strong', null, 'iNat ID: '), specimen.inaturalist_id
                                ),
                                React.createElement('div', { className: 'text-sm' },
                                    React.createElement('strong', null, 'Quality: '), 
                                    `${((specimen.quality_score || 0) * 100).toFixed(0)}%`
                                )
                            ),
                            React.createElement('div', { className: 'text-xs text-gray-500' },
                                'Added: ', new Date(specimen.created_at).toLocaleDateString()
                            )
                        )
                    )
                )
            );
        }

        function ApprovedSpecimens({ specimens }) {
            return React.createElement('div', { className: 'space-y-4' },
                React.createElement('div', { className: 'flex justify-between items-center' },
                    React.createElement('h2', { className: 'text-2xl font-bold' }, 'Approved Specimens'),
                    React.createElement('p', { className: 'text-gray-600' }, `${specimens.length} approved`)
                ),
                React.createElement('div', { className: 'grid gap-4' },
                    ...specimens.map(specimen =>
                        React.createElement('div', {
                            key: specimen.id,
                            className: 'bg-white rounded-xl p-4 shadow-sm'
                        },
                            React.createElement('div', { className: 'flex justify-between items-start' },
                                React.createElement('div', null,
                                    React.createElement('h3', { className: 'font-semibold text-lg' }, specimen.species_name),
                                    React.createElement('p', { className: 'text-gray-600' }, specimen.location),
                                    React.createElement('p', { className: 'text-sm text-gray-500' },
                                        'Approved: ', specimen.approved_at ? new Date(specimen.approved_at).toLocaleDateString() : 'Unknown'
                                    )
                                ),
                                React.createElement('div', { className: 'flex items-center gap-2' },
                                    React.createElement(StatusBadge, { status: specimen.status }),
                                    specimen.dna_sequenced && React.createElement('span', {
                                        className: 'text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded'
                                    }, 'DNA')
                                )
                            )
                        )
                    )
                )
            );
        }

        function AllSpecimens({ specimens }) {
            const [filter, setFilter] = useState('all');
            
            const filteredSpecimens = specimens.filter(specimen => {
                return filter === 'all' || specimen.status === filter;
            });

            return React.createElement('div', { className: 'space-y-6' },
                React.createElement('div', { className: 'flex justify-between items-center' },
                    React.createElement('h2', { className: 'text-2xl font-bold' }, 'All Specimens'),
                    React.createElement('select', {
                        value: filter,
                        onChange: (e) => setFilter(e.target.value),
                        className: 'px-3 py-1 border rounded'
                    },
                        React.createElement('option', { value: 'all' }, 'All Status'),
                        React.createElement('option', { value: 'pending' }, 'Pending'),
                        React.createElement('option', { value: 'approved' }, 'Approved'),
                        React.createElement('option', { value: 'rejected' }, 'Rejected')
                    )
                ),
                React.createElement('div', { className: 'bg-white rounded-lg shadow overflow-hidden' },
                    React.createElement('table', { className: 'min-w-full' },
                        React.createElement('thead', { className: 'bg-gray-50' },
                            React.createElement('tr', null,
                                React.createElement('th', { className: 'px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase' }, 'Species'),
                                React.createElement('th', { className: 'px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase' }, 'Status'),
                                React.createElement('th', { className: 'px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase' }, 'Location'),
                                React.createElement('th', { className: 'px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase' }, 'DNA'),
                                React.createElement('th', { className: 'px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase' }, 'Date')
                            )
                        ),
                        React.createElement('tbody', { className: 'divide-y divide-gray-200' },
                            ...filteredSpecimens.map(specimen =>
                                React.createElement('tr', {
                                    key: specimen.id,
                                    className: 'hover:bg-gray-50'
                                },
                                    React.createElement('td', { className: 'px-6 py-4' },
                                        React.createElement('div', null,
                                            React.createElement('div', { className: 'font-medium' }, specimen.species_name),
                                            React.createElement('div', { className: 'text-sm text-gray-500' }, specimen.family)
                                        )
                                    ),
                                    React.createElement('td', { className: 'px-6 py-4' },
                                        React.createElement(StatusBadge, { status: specimen.status })
                                    ),
                                    React.createElement('td', { className: 'px-6 py-4 text-sm' }, specimen.location),
                                    React.createElement('td', { className: 'px-6 py-4' },
                                        specimen.dna_sequenced 
                                            ? React.createElement('span', { className: 'text-green-600' }, '‚úì Yes')
                                            : React.createElement('span', { className: 'text-gray-400' }, '‚úó No')
                                    ),
                                    React.createElement('td', { className: 'px-6 py-4 text-sm' },
                                        new Date(specimen.created_at).toLocaleDateString()
                                    )
                                )
                            )
                        )
                    ),
                    filteredSpecimens.length === 0 && React.createElement('div', {
                        className: 'text-center py-8 text-gray-500'
                    }, 'No specimens found matching your criteria.')
                )
            );
        }

        function StatCard({ title, value, color }) {
            return React.createElement('div', { className: 'bg-white rounded-xl p-6 shadow-sm' },
                React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement('div', null,
                        React.createElement('p', { className: 'text-sm text-gray-600' }, title),
                        React.createElement('p', { className: `text-2xl font-bold ${color}` }, value || 0)
                    )
                )
            );
        }

        function StatusBadge({ status }) {
            const statusConfig = {
                pending: { color: 'bg-orange-100 text-orange-800', label: 'Pending' },
                approved: { color: 'bg-green-100 text-green-800', label: 'Approved' },
                rejected: { color: 'bg-red-100 text-red-800', label: 'Rejected' }
            };

            const config = statusConfig[status] || statusConfig.pending;

            return React.createElement('span', {
                className: `px-3 py-1 rounded-full text-sm font-medium ${config.color}`
            }, config.label);
        }

        // Render the app
        try {
            console.log('üé¨ About to render AdminPortal...');
            const root = ReactDOM.createRoot(document.getElementById('admin-root'));
            root.render(React.createElement(AdminPortal));
            console.log('‚úÖ AdminPortal rendered successfully');
        } catch (error) {
            console.error('‚ùå Error rendering AdminPortal:', error);
            document.getElementById('admin-root').innerHTML = `
                <div style="padding: 20px; color: red; text-align: center;">
                    <h1>Rendering Error</h1>
                    <p>Error: ${error.message}</p>
                    <p>Check the console for details.</p>
                </div>
            `;
        }
    </script>
</body>
</html>