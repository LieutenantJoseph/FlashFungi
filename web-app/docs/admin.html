<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arizona Mushroom Study - Admin Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <style>
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .skeleton { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: loading 1.5s infinite; }
        @keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
</head>
<body>
    <div id="admin-root">
        <div class="min-h-screen bg-gray-50 flex items-center justify-center">
            <div class="text-center">
                <div class="text-6xl mb-4">üõ°Ô∏è</div>
                <h1 class="text-2xl font-bold text-gray-800 mb-2">Admin Portal Loading...</h1>
                <p class="text-gray-600">Initializing management system...</p>
            </div>
        </div>
    </div>

    <script>
        // Wait for React to load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(initializeAdminPortal, 100);
        });

        function initializeAdminPortal() {
            if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
                console.error('React libraries not loaded');
                return;
            }

            const { useState, useEffect, useCallback, useMemo } = React;
            const h = React.createElement;
            
            // Configuration
            const SUPABASE_URL = 'https://oxgedcncrettasrbmwsl.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im94Z2VkY25jcmV0dGFzcmJtd3NsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5MDY4NjQsImV4cCI6MjA2OTQ4Mjg2NH0.mu0Cb6qRr4cja0vsSzIuLwDTtNFuimWUwNs_JbnO3Pg';
            const API_BASE = '/api';

            // Utility Functions
            const debounce = (func, wait) => {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            };

            // Toast Notification Component
            function Toast({ message, type, onClose }) {
                useEffect(() => {
                    const timer = setTimeout(onClose, 3000);
                    return () => clearTimeout(timer);
                }, [onClose]);

                const bgColor = type === 'success' ? 'bg-green-500' : 
                               type === 'error' ? 'bg-red-500' : 'bg-blue-500';

                return h('div', { 
                    className: `fixed bottom-4 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg fade-in z-50`
                },
                    h('div', { className: 'flex items-center gap-2' },
                        h('span', null, message),
                        h('button', { onClick: onClose, className: 'ml-2 text-white/80 hover:text-white' }, '√ó')
                    )
                );
            }

            // Enhanced Species Hints Manager Component
            function SpeciesHintsManager({ species, specimens, onClose, onSave }) {
                const [hints, setHints] = useState(species.hints || []);
                const [loading, setLoading] = useState(false);
                const [generating, setGenerating] = useState(false);
                const [editingHint, setEditingHint] = useState(null);
                const [referenceUrl, setReferenceUrl] = useState('');
                const [aiModel, setAiModel] = useState('gpt-4');
                const [customPrompt, setCustomPrompt] = useState('');

                const specimenCount = specimens.filter(s => s.species_name === species.species_name).length;
                const dnaVerifiedCount = specimens.filter(s => s.species_name === species.species_name && s.dna_sequenced).length;

                const generateHintsWithAI = async () => {
                    setGenerating(true);
                    try {
                        const response = await fetch(`${API_BASE}/generate-hints`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                species_name: species.species_name,
                                family: species.family,
                                genus: species.genus,
                                common_name: species.common_name,
                                reference_url: referenceUrl,
                                ai_model: aiModel,
                                custom_prompt: customPrompt,
                                specimen_data: {
                                    count: specimenCount,
                                    dna_verified: dnaVerifiedCount,
                                    habitats: [...new Set(specimens
                                        .filter(s => s.species_name === species.species_name)
                                        .map(s => s.habitat)
                                        .filter(Boolean)
                                    )]
                                }
                            })
                        });

                        if (response.ok) {
                            const data = await response.json();
                            setHints(data.hints);
                        }
                    } catch (error) {
                        console.error('Error generating hints:', error);
                    } finally {
                        setGenerating(false);
                    }
                };

                const saveHints = async () => {
                    setLoading(true);
                    try {
                        const hintsData = {
                            species_name: species.species_name,
                            genus: species.genus,
                            family: species.family,
                            common_name: species.common_name,
                            hints: hints,
                            source_quality: referenceUrl ? 'ai-enhanced' : 'ai-generated',
                            ai_confidence: 0.85,
                            admin_reviewed: true,
                            reference_url: referenceUrl || null
                        };

                        const url = species.id 
                            ? `${SUPABASE_URL}/rest/v1/species_hints?id=eq.${species.id}`
                            : `${SUPABASE_URL}/rest/v1/species_hints`;

                        const response = await fetch(url, {
                            method: species.id ? 'PATCH' : 'POST',
                            headers: {
                                'apikey': SUPABASE_ANON_KEY,
                                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(hintsData)
                        });

                        if (response.ok) {
                            onSave(hintsData);
                            onClose();
                        }
                    } catch (error) {
                        console.error('Error saving hints:', error);
                    } finally {
                        setLoading(false);
                    }
                };

                const updateHint = (index, updates) => {
                    const newHints = [...hints];
                    newHints[index] = { ...newHints[index], ...updates };
                    setHints(newHints);
                };

                const addCustomHint = () => {
                    setHints([...hints, {
                        type: 'custom',
                        level: hints.length + 1,
                        text: '',
                        educational_value: 'medium'
                    }]);
                };

                const removeHint = (index) => {
                    setHints(hints.filter((_, i) => i !== index));
                };

                const hintTypes = [
                    { value: 'morphological', label: 'Morphological', icon: 'üîç', color: 'green' },
                    { value: 'comparative', label: 'Comparative', icon: '‚öñÔ∏è', color: 'blue' },
                    { value: 'ecological', label: 'Ecological', icon: 'üå≤', color: 'emerald' },
                    { value: 'taxonomic', label: 'Taxonomic', icon: 'üìö', color: 'purple' },
                    { value: 'custom', label: 'Custom', icon: '‚úèÔ∏è', color: 'gray' }
                ];

                return h('div', { className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50' },
                    h('div', { className: 'bg-white rounded-xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col' },
                        // Header
                        h('div', { className: 'bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-6' },
                            h('div', { className: 'flex justify-between items-start' },
                                h('div', null,
                                    h('h2', { className: 'text-2xl font-bold mb-2' }, `Species Hints: ${species.species_name}`),
                                    h('div', { className: 'flex gap-4 text-sm opacity-90' },
                                        h('span', null, `${specimenCount} specimens`),
                                        dnaVerifiedCount > 0 && h('span', null, `${dnaVerifiedCount} DNA verified`),
                                        h('span', null, `Family: ${species.family}`)
                                    )
                                ),
                                h('button', {
                                    onClick: onClose,
                                    className: 'text-white hover:text-gray-200 text-2xl'
                                }, '√ó')
                            )
                        ),

                        // Content
                        h('div', { className: 'flex-1 overflow-y-auto p-6' },
                            // AI Generation Section
                            h('div', { className: 'bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 mb-6' },
                                h('h3', { className: 'font-semibold mb-3 flex items-center gap-2' },
                                    h('span', null, 'ü§ñ'),
                                    'AI Hint Generation'
                                ),
                                h('div', { className: 'grid md:grid-cols-2 gap-4' },
                                    h('div', null,
                                        h('label', { className: 'block text-sm font-medium mb-1' }, 'Reference URL (optional)'),
                                        h('input', {
                                            type: 'url',
                                            value: referenceUrl,
                                            onChange: (e) => setReferenceUrl(e.target.value),
                                            placeholder: 'https://mushroomexpert.com/species...',
                                            className: 'w-full px-3 py-2 border rounded-lg text-sm'
                                        })
                                    ),
                                    h('div', null,
                                        h('label', { className: 'block text-sm font-medium mb-1' }, 'AI Model'),
                                        h('select', {
                                            value: aiModel,
                                            onChange: (e) => setAiModel(e.target.value),
                                            className: 'w-full px-3 py-2 border rounded-lg text-sm'
                                        },
                                            h('option', { value: 'gpt-4' }, 'GPT-4 (Best Quality)'),
                                            h('option', { value: 'gpt-4-turbo' }, 'GPT-4 Turbo (Faster)'),
                                            h('option', { value: 'gpt-3.5-turbo' }, 'GPT-3.5 Turbo (Budget)')
                                        )
                                    )
                                ),
                                h('div', { className: 'mt-3' },
                                    h('label', { className: 'block text-sm font-medium mb-1' }, 'Custom Instructions (optional)'),
                                    h('textarea', {
                                        value: customPrompt,
                                        onChange: (e) => setCustomPrompt(e.target.value),
                                        placeholder: 'Add specific instructions for hint generation...',
                                        className: 'w-full px-3 py-2 border rounded-lg text-sm',
                                        rows: 2
                                    })
                                ),
                                h('div', { className: 'flex gap-2 mt-3' },
                                    h('button', {
                                        onClick: generateHintsWithAI,
                                        disabled: generating,
                                        className: `px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 ${generating ? 'cursor-wait' : ''}`
                                    }, generating ? 'Generating...' : '‚ú® Generate with AI'),
                                    hints.length === 0 && h('button', {
                                        onClick: () => {
                                            // Generate template hints
                                            setHints([
                                                { type: 'morphological', level: 1, text: '', educational_value: 'high' },
                                                { type: 'comparative', level: 2, text: '', educational_value: 'high' },
                                                { type: 'ecological', level: 3, text: '', educational_value: 'medium' },
                                                { type: 'taxonomic', level: 4, text: '', educational_value: 'low' }
                                            ]);
                                        },
                                        className: 'px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700'
                                    }, 'üìù Use Template')
                                )
                            ),

                            // Hints Editor
                            h('div', { className: 'space-y-4' },
                                h('div', { className: 'flex justify-between items-center mb-3' },
                                    h('h3', { className: 'font-semibold' }, 'Hint Editor'),
                                    h('button', {
                                        onClick: addCustomHint,
                                        className: 'px-3 py-1 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm'
                                    }, '+ Add Custom Hint')
                                ),

                                hints.length === 0 ? 
                                    h('div', { className: 'text-center py-8 bg-gray-50 rounded-lg' },
                                        h('p', { className: 'text-gray-600 mb-3' }, 'No hints configured yet'),
                                        h('p', { className: 'text-sm text-gray-500' }, 'Generate hints with AI or use a template to get started')
                                    ) :
                                    hints.map((hint, index) => {
                                        const hintType = hintTypes.find(t => t.value === hint.type) || hintTypes[4];
                                        
                                        return h('div', {
                                            key: index,
                                            className: `border rounded-lg p-4 ${editingHint === index ? 'border-indigo-500 bg-indigo-50' : 'border-gray-200'}`
                                        },
                                            h('div', { className: 'flex justify-between items-start mb-3' },
                                                h('div', { className: 'flex items-center gap-3' },
                                                    h('span', { className: 'text-2xl' }, hintType.icon),
                                                    h('div', null,
                                                        h('select', {
                                                            value: hint.type,
                                                            onChange: (e) => updateHint(index, { type: e.target.value }),
                                                            className: 'font-medium text-sm border rounded px-2 py-1'
                                                        },
                                                            hintTypes.map(type =>
                                                                h('option', { key: type.value, value: type.value }, type.label)
                                                            )
                                                        ),
                                                        h('div', { className: 'flex items-center gap-2 mt-1' },
                                                            h('span', { className: 'text-xs text-gray-500' }, 'Level:'),
                                                            h('input', {
                                                                type: 'number',
                                                                value: hint.level,
                                                                onChange: (e) => updateHint(index, { level: parseInt(e.target.value) }),
                                                                min: 1,
                                                                max: 10,
                                                                className: 'w-12 text-xs border rounded px-1'
                                                            }),
                                                            h('span', { className: 'text-xs text-gray-500 ml-2' }, 'Value:'),
                                                            h('select', {
                                                                value: hint.educational_value,
                                                                onChange: (e) => updateHint(index, { educational_value: e.target.value }),
                                                                className: 'text-xs border rounded px-1'
                                                            },
                                                                h('option', { value: 'high' }, 'High'),
                                                                h('option', { value: 'medium' }, 'Medium'),
                                                                h('option', { value: 'low' }, 'Low')
                                                            )
                                                        )
                                                    )
                                                ),
                                                h('button', {
                                                    onClick: () => removeHint(index),
                                                    className: 'text-red-500 hover:text-red-700'
                                                }, 'üóëÔ∏è')
                                            ),
                                            h('textarea', {
                                                value: hint.text,
                                                onChange: (e) => updateHint(index, { text: e.target.value }),
                                                onFocus: () => setEditingHint(index),
                                                onBlur: () => setEditingHint(null),
                                                placeholder: `Enter ${hint.type} hint text...`,
                                                className: 'w-full px-3 py-2 border rounded-lg text-sm',
                                                rows: 3
                                            }),
                                            hint.text && h('div', { className: 'mt-2 text-xs text-gray-500' },
                                                `${hint.text.length} characters`
                                            )
                                        );
                                    })
                            )
                        ),

                        // Footer
                        h('div', { className: 'border-t p-6 bg-gray-50' },
                            h('div', { className: 'flex justify-between items-center' },
                                h('div', { className: 'text-sm text-gray-600' },
                                    hints.filter(h => h.text).length > 0 && 
                                    `${hints.filter(h => h.text).length} hints configured`
                                ),
                                h('div', { className: 'flex gap-3' },
                                    h('button', {
                                        onClick: onClose,
                                        className: 'px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-100'
                                    }, 'Cancel'),
                                    h('button', {
                                        onClick: saveHints,
                                        disabled: loading || hints.filter(h => h.text).length === 0,
                                        className: 'px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50'
                                    }, loading ? 'Saving...' : 'üíæ Save Hints')
                                )
                            )
                        )
                    )
                );
            }

            // Enhanced Specimen Review Modal
            function SpecimenReviewModal({ specimen, speciesHints, onClose, onApprove, onDelete, onUpdatePhotos }) {
                const [notes, setNotes] = useState(specimen.admin_notes || '');
                const [selectedPhotos, setSelectedPhotos] = useState(specimen.selected_photos || []);
                const [photos, setPhotos] = useState([]);
                const [loadingPhotos, setLoadingPhotos] = useState(true);
                const [activeTab, setActiveTab] = useState('details');

                useEffect(() => {
                    loadPhotos();
                }, []);

                const loadPhotos = async () => {
                    try {
                        const response = await fetch(`https://api.inaturalist.org/v1/observations/${specimen.inaturalist_id}`);
                        const data = await response.json();
                        if (data.results && data.results[0] && data.results[0].photos) {
                            setPhotos(data.results[0].photos);
                            if (selectedPhotos.length === 0) {
                                setSelectedPhotos(data.results[0].photos.map(p => p.id));
                            }
                        }
                    } catch (error) {
                        console.error('Error loading photos:', error);
                    } finally {
                        setLoadingPhotos(false);
                    }
                };

                const togglePhotoSelection = (photoId) => {
                    setSelectedPhotos(prev => 
                        prev.includes(photoId) 
                            ? prev.filter(id => id !== photoId)
                            : [...prev, photoId]
                    );
                };

                const hasHints = speciesHints && speciesHints.hints && speciesHints.hints.length > 0;

                return h('div', { className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50' },
                    h('div', { className: 'bg-white rounded-xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col' },
                        // Header
                        h('div', { className: 'bg-gradient-to-r from-green-600 to-emerald-600 text-white p-6' },
                            h('div', { className: 'flex justify-between items-start' },
                                h('div', null,
                                    h('h2', { className: 'text-2xl font-bold mb-2' }, specimen.species_name),
                                    h('div', { className: 'flex items-center gap-4 text-sm opacity-90' },
                                        specimen.common_name && h('span', null, specimen.common_name),
                                        h('span', null, `Family: ${specimen.family}`),
                                        specimen.dna_sequenced && h('span', { className: 'bg-white/20 px-2 py-1 rounded' }, 'üß¨ DNA Verified'),
                                        h('span', { className: `bg-white/20 px-2 py-1 rounded` },
                                            specimen.status === 'approved' ? '‚úÖ Approved' : '‚è≥ Pending'
                                        )
                                    )
                                ),
                                h('button', {
                                    onClick: onClose,
                                    className: 'text-white hover:text-gray-200 text-2xl'
                                }, '√ó')
                            )
                        ),

                        // Tabs
                        h('div', { className: 'border-b bg-gray-50' },
                            h('div', { className: 'flex gap-4 px-6' },
                                ['details', 'photos', 'hints'].map(tab =>
                                    h('button', {
                                        key: tab,
                                        onClick: () => setActiveTab(tab),
                                        className: `py-3 px-4 border-b-2 transition-colors capitalize ${
                                            activeTab === tab 
                                                ? 'border-green-600 text-green-600 font-medium' 
                                                : 'border-transparent text-gray-600 hover:text-gray-800'
                                        }`
                                    }, tab)
                                )
                            )
                        ),

                        // Content
                        h('div', { className: 'flex-1 overflow-y-auto p-6' },
                            // Details Tab
                            activeTab === 'details' && h('div', { className: 'space-y-6' },
                                h('div', { className: 'grid md:grid-cols-2 gap-6' },
                                    h('div', { className: 'bg-gray-50 rounded-lg p-4' },
                                        h('h3', { className: 'font-semibold mb-3' }, 'üìã Specimen Information'),
                                        h('div', { className: 'space-y-2 text-sm' },
                                            h('div', null, h('strong', null, 'Species: '), specimen.species_name),
                                            h('div', null, h('strong', null, 'Genus: '), specimen.genus),
                                            h('div', null, h('strong', null, 'Family: '), specimen.family),
                                            specimen.common_name && h('div', null, h('strong', null, 'Common Name: '), specimen.common_name),
                                            h('div', null, h('strong', null, 'Location: '), specimen.location),
                                            h('div', null, h('strong', null, 'DNA Sequenced: '), 
                                                specimen.dna_sequenced ? 
                                                    h('span', { className: 'text-green-600 font-medium' }, 'Yes ‚úì') : 
                                                    h('span', { className: 'text-gray-500' }, 'No')
                                            )
                                        )
                                    ),
                                    h('div', { className: 'bg-gray-50 rounded-lg p-4' },
                                        h('h3', { className: 'font-semibold mb-3' }, 'üåç Collection Data'),
                                        h('div', { className: 'space-y-2 text-sm' },
                                            h('div', null, h('strong', null, 'Habitat: '), specimen.habitat || 'Not specified'),
                                            h('div', null, h('strong', null, 'Quality Score: '), 
                                                h('div', { className: 'inline-flex items-center gap-2' },
                                                    h('div', { className: 'w-32 bg-gray-200 rounded-full h-2' },
                                                        h('div', {
                                                            className: 'bg-green-600 h-2 rounded-full',
                                                            style: { width: `${(specimen.quality_score || 0) * 100}%` }
                                                        })
                                                    ),
                                                    `${((specimen.quality_score || 0) * 100).toFixed(0)}%`
                                                )
                                            ),
                                            h('div', null, h('strong', null, 'Created: '), 
                                                new Date(specimen.created_at).toLocaleDateString()
                                            ),
                                            h('div', null,
                                                h('strong', null, 'iNaturalist: '),
                                                h('a', {
                                                    href: `https://www.inaturalist.org/observations/${specimen.inaturalist_id}`,
                                                    target: '_blank',
                                                    className: 'text-blue-600 hover:text-blue-800'
                                                }, `Observation #${specimen.inaturalist_id} ‚Üó`)
                                            )
                                        )
                                    )
                                ),
                                h('div', null,
                                    h('h3', { className: 'font-semibold mb-3' }, 'üìù Admin Notes'),
                                    h('textarea', {
                                        value: notes,
                                        onChange: (e) => setNotes(e.target.value),
                                        placeholder: 'Add notes about this specimen...',
                                        className: 'w-full p-3 border rounded-lg resize-none',
                                        rows: 4
                                    })
                                )
                            ),

                            // Photos Tab
                            activeTab === 'photos' && h('div', { className: 'space-y-4' },
                                h('div', { className: 'flex justify-between items-center mb-4' },
                                    h('h3', { className: 'font-semibold' }, 'Photo Selection'),
                                    h('p', { className: 'text-sm text-gray-600' }, 
                                        `${selectedPhotos.length} of ${photos.length} photos selected for study`
                                    )
                                ),
                                loadingPhotos ? 
                                    h('div', { className: 'text-center py-8' },
                                        h('div', { className: 'skeleton h-48 w-full rounded-lg mb-4' }),
                                        h('p', { className: 'text-gray-600' }, 'Loading photos...')
                                    ) :
                                    photos.length > 0 ?
                                        h('div', { className: 'grid md:grid-cols-3 gap-4' },
                                            photos.map(photo => 
                                                h('div', {
                                                    key: photo.id,
                                                    className: `relative border-2 rounded-lg overflow-hidden cursor-pointer transition-all ${
                                                        selectedPhotos.includes(photo.id) 
                                                            ? 'border-green-500 shadow-lg' 
                                                            : 'border-gray-200 hover:border-gray-400'
                                                    }`,
                                                    onClick: () => togglePhotoSelection(photo.id)
                                                },
                                                    h('img', {
                                                        src: photo.url.replace('square', 'medium'),
                                                        alt: 'Specimen photo',
                                                        className: 'w-full h-48 object-cover'
                                                    }),
                                                    selectedPhotos.includes(photo.id) && h('div', {
                                                        className: 'absolute top-2 right-2 bg-green-500 text-white rounded-full p-1'
                                                    },
                                                        h('svg', { className: 'w-5 h-5', fill: 'currentColor', viewBox: '0 0 20 20' },
                                                            h('path', { 
                                                                fillRule: 'evenodd',
                                                                d: 'M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z',
                                                                clipRule: 'evenodd'
                                                            })
                                                        )
                                                    ),
                                                    h('div', { className: 'p-2 bg-white' },
                                                        h('p', { className: 'text-xs text-gray-600 truncate' }, 
                                                            photo.attribution || 'Photo by iNaturalist user'
                                                        )
                                                    )
                                                )
                                            )
                                        ) :
                                        h('div', { className: 'text-center py-8 bg-gray-50 rounded-lg' },
                                            h('p', { className: 'text-gray-600' }, 'No photos available')
                                        ),
                                h('div', { className: 'mt-4 p-4 bg-blue-50 rounded-lg' },
                                    h('p', { className: 'text-sm text-blue-800' },
                                        'üí° Select the best photos for study. Include multiple angles and features for better learning.'
                                    )
                                )
                            ),

                            // Hints Tab
                            activeTab === 'hints' && h('div', { className: 'space-y-4' },
                                h('div', { className: 'flex justify-between items-center mb-4' },
                                    h('h3', { className: 'font-semibold' }, 'Species-Level Hints'),
                                    h('div', {
                                        className: `px-3 py-1 rounded-full text-sm ${
                                            hasHints ? 'bg-green-100 text-green-800' : 'bg-orange-100 text-orange-800'
                                        }`
                                    }, hasHints ? `${speciesHints.hints.length} hints configured` : 'No hints configured')
                                ),
                                hasHints ? 
                                    h('div', { className: 'space-y-3' },
                                        speciesHints.hints.map((hint, index) =>
                                            h('div', {
                                                key: index,
                                                className: 'bg-gray-50 rounded-lg p-4 border-l-4',
                                                style: { 
                                                    borderLeftColor: hint.type === 'morphological' ? '#10b981' :
                                                                    hint.type === 'comparative' ? '#3b82f6' :
                                                                    hint.type === 'ecological' ? '#059669' :
                                                                    hint.type === 'taxonomic' ? '#8b5cf6' : '#6b7280'
                                                }
                                            },
                                                h('div', { className: 'flex justify-between items-start mb-2' },
                                                    h('div', { className: 'flex items-center gap-2' },
                                                        h('span', { className: 'font-medium capitalize' }, hint.type),
                                                        h('span', { className: 'text-xs bg-gray-200 px-2 py-1 rounded' }, 
                                                            `Level ${hint.level}`
                                                        ),
                                                        h('span', { 
                                                            className: `text-xs px-2 py-1 rounded ${
                                                                hint.educational_value === 'high' ? 'bg-green-100 text-green-800' :
                                                                hint.educational_value === 'medium' ? 'bg-yellow-100 text-yellow-800' :
                                                                'bg-gray-100 text-gray-800'
                                                            }`
                                                        }, hint.educational_value)
                                                    )
                                                ),
                                                h('p', { className: 'text-sm text-gray-700' }, hint.text)
                                            )
                                        ),
                                        speciesHints.admin_reviewed && h('div', { className: 'mt-4 flex items-center gap-2 text-sm text-green-600' },
                                            h('svg', { className: 'w-5 h-5', fill: 'currentColor', viewBox: '0 0 20 20' },
                                                h('path', { 
                                                    fillRule: 'evenodd',
                                                    d: 'M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z',
                                                    clipRule: 'evenodd'
                                                })
                                            ),
                                            'Admin Reviewed'
                                        )
                                    ) :
                                    h('div', { className: 'bg-orange-50 border border-orange-200 rounded-lg p-6 text-center' },
                                        h('p', { className: 'text-orange-800 mb-2' }, 
                                            '‚ö†Ô∏è This species needs hints before specimens can be used for study.'
                                        ),
                                        h('p', { className: 'text-sm text-orange-600' },
                                            'Configure hints in the Species Hints section or generate them with AI.'
                                        )
                                    )
                            )
                        ),

                        // Footer
                        h('div', { className: 'border-t p-6 bg-gray-50' },
                            h('div', { className: 'flex justify-between items-center' },
                                h('div', { className: 'flex items-center gap-4' },
                                    !hasHints && specimen.status === 'pending' && 
                                    h('p', { className: 'text-sm text-orange-600' },
                                        '‚ö†Ô∏è Configure species hints before approving'
                                    )
                                ),
                                h('div', { className: 'flex gap-3' },
                                    specimen.status === 'pending' && [
                                        h('button', {
                                            key: 'delete',
                                            onClick: () => onDelete(),
                                            className: 'px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700'
                                        }, 'üóëÔ∏è Delete'),
                                        h('button', {
                                            key: 'approve',
                                            onClick: () => onApprove(notes, selectedPhotos),
                                            disabled: !hasHints,
                                            className: `px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 ${
                                                !hasHints ? 'cursor-not-allowed' : ''
                                            }`
                                        }, '‚úÖ Approve')
                                    ],
                                    specimen.status === 'approved' && h('button', {
                                        onClick: () => onUpdatePhotos(selectedPhotos, notes),
                                        className: 'px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700'
                                    }, 'üíæ Update'),
                                    h('button', {
                                        onClick: onClose,
                                        className: 'px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-100'
                                    }, 'Close')
                                )
                            )
                        )
                    )
                );
            }

            // Main Admin Portal Component
            function AdminPortal() {
                const [currentView, setCurrentView] = useState('dashboard');
                const [specimens, setSpecimens] = useState([]);
                const [speciesHints, setSpeciesHints] = useState([]);
                const [loading, setLoading] = useState(true);
                const [selectedSpecimen, setSelectedSpecimen] = useState(null);
                const [selectedSpecies, setSelectedSpecies] = useState(null);
                const [toast, setToast] = useState(null);
                const [searchTerm, setSearchTerm] = useState('');
                const [filterStatus, setFilterStatus] = useState('all');
                const [sortBy, setSortBy] = useState('created_at');

                useEffect(() => {
                    loadData();
                }, []);

                const loadData = async () => {
                    try {
                        // Load specimens
                        const specimensResponse = await fetch(
                            `${SUPABASE_URL}/rest/v1/specimens?select=*&order=created_at.desc`,
                            {
                                headers: {
                                    'apikey': SUPABASE_ANON_KEY,
                                    'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                                }
                            }
                        );
                        
                        if (specimensResponse.ok) {
                            const data = await specimensResponse.json();
                            setSpecimens(data || []);
                        }

                        // Load species hints
                        const hintsResponse = await fetch(
                            `${SUPABASE_URL}/rest/v1/species_hints?select=*`,
                            {
                                headers: {
                                    'apikey': SUPABASE_ANON_KEY,
                                    'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                                }
                            }
                        );
                        
                        if (hintsResponse.ok) {
                            const hintsData = await hintsResponse.json();
                            setSpeciesHints(hintsData || []);
                        }
                    } catch (error) {
                        console.error('Error loading data:', error);
                        showToast('Error loading data', 'error');
                    } finally {
                        setLoading(false);
                    }
                };

                const showToast = (message, type = 'info') => {
                    setToast({ message, type });
                };

                const handleApproveSpecimen = async (notes, selectedPhotos) => {
                    try {
                        const response = await fetch(`${API_BASE}/admin`, {
                            method: 'PATCH',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                specimenId: selectedSpecimen.id,
                                status: 'approved',
                                notes: notes,
                                selectedPhotoIds: selectedPhotos
                            })
                        });

                        if (response.ok) {
                            showToast('Specimen approved successfully', 'success');
                            setSelectedSpecimen(null);
                            loadData();
                        } else {
                            showToast('Failed to approve specimen', 'error');
                        }
                    } catch (error) {
                        console.error('Error approving specimen:', error);
                        showToast('Error approving specimen', 'error');
                    }
                };

                const handleDeleteSpecimen = async () => {
                    if (!confirm(`Delete specimen "${selectedSpecimen.species_name}"? This cannot be undone.`)) return;
                    
                    try {
                        const response = await fetch(`${API_BASE}/admin`, {
                            method: 'DELETE',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ specimenId: selectedSpecimen.id })
                        });

                        if (response.ok) {
                            showToast('Specimen deleted successfully', 'success');
                            setSelectedSpecimen(null);
                            loadData();
                        } else {
                            showToast('Failed to delete specimen', 'error');
                        }
                    } catch (error) {
                        console.error('Error deleting specimen:', error);
                        showToast('Error deleting specimen', 'error');
                    }
                };

                const handleUpdatePhotos = async (selectedPhotos, notes) => {
                    try {
                        const response = await fetch(`${API_BASE}/admin`, {
                            method: 'PATCH',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                specimenId: selectedSpecimen.id,
                                notes: notes,
                                selectedPhotoIds: selectedPhotos
                            })
                        });

                        if (response.ok) {
                            showToast('Specimen updated successfully', 'success');
                            setSelectedSpecimen(null);
                            loadData();
                        } else {
                            showToast('Failed to update specimen', 'error');
                        }
                    } catch (error) {
                        console.error('Error updating specimen:', error);
                        showToast('Error updating specimen', 'error');
                    }
                };

                const handleSaveSpeciesHints = (updatedHints) => {
                    showToast('Species hints saved successfully', 'success');
                    loadData();
                };

                // Calculate statistics
                const stats = useMemo(() => {
                    const total = specimens.length;
                    const pending = specimens.filter(s => s.status === 'pending').length;
                    const approved = specimens.filter(s => s.status === 'approved').length;
                    const dnaVerified = specimens.filter(s => s.dna_sequenced).length;
                    const uniqueSpecies = new Set(specimens.map(s => s.species_name)).size;
                    const speciesWithHints = new Set(speciesHints.map(h => h.species_name)).size;
                    const hintsCompleteness = uniqueSpecies > 0 ? Math.round((speciesWithHints / uniqueSpecies) * 100) : 0;

                    return { total, pending, approved, dnaVerified, uniqueSpecies, speciesWithHints, hintsCompleteness };
                }, [specimens, speciesHints]);

                // Filter and sort specimens
                const filteredSpecimens = useMemo(() => {
                    let filtered = [...specimens];
                    
                    if (searchTerm) {
                        filtered = filtered.filter(s => 
                            s.species_name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                            s.genus.toLowerCase().includes(searchTerm.toLowerCase()) ||
                            s.family.toLowerCase().includes(searchTerm.toLowerCase()) ||
                            (s.common_name && s.common_name.toLowerCase().includes(searchTerm.toLowerCase()))
                        );
                    }
                    
                    if (filterStatus !== 'all') {
                        filtered = filtered.filter(s => s.status === filterStatus);
                    }
                    
                    filtered.sort((a, b) => {
                        switch(sortBy) {
                            case 'species_name': return a.species_name.localeCompare(b.species_name);
                            case 'quality_score': return (b.quality_score || 0) - (a.quality_score || 0);
                            case 'created_at': 
                            default: return new Date(b.created_at) - new Date(a.created_at);
                        }
                    });
                    
                    return filtered;
                }, [specimens, searchTerm, filterStatus, sortBy]);

                // Get unique species for hints management
                const uniqueSpeciesList = useMemo(() => {
                    const speciesMap = new Map();
                    specimens.forEach(s => {
                        if (!speciesMap.has(s.species_name)) {
                            speciesMap.set(s.species_name, {
                                species_name: s.species_name,
                                genus: s.genus,
                                family: s.family,
                                common_name: s.common_name,
                                specimens: []
                            });
                        }
                        speciesMap.get(s.species_name).specimens.push(s);
                    });
                    
                    return Array.from(speciesMap.values()).map(species => {
                        const hints = speciesHints.find(h => h.species_name === species.species_name);
                        return { ...species, ...hints };
                    });
                }, [specimens, speciesHints]);

                if (loading) {
                    return h('div', { className: 'min-h-screen bg-gray-50 flex items-center justify-center' },
                        h('div', { className: 'text-center' },
                            h('div', { className: 'text-6xl mb-4 animate-pulse' }, 'üõ°Ô∏è'),
                            h('h1', { className: 'text-2xl font-bold text-gray-800 mb-2' }, 'Loading Admin Portal'),
                            h('p', { className: 'text-gray-600' }, 'Fetching specimens and configuration...')
                        )
                    );
                }

                return h('div', { className: 'min-h-screen bg-gray-50' },
                    // Header
                    h('div', { className: 'bg-gradient-to-r from-slate-800 to-slate-900 text-white shadow-lg' },
                        h('div', { className: 'max-w-7xl mx-auto px-4 py-6' },
                            h('div', { className: 'flex justify-between items-center' },
                                h('div', { className: 'flex items-center gap-4' },
                                    h('div', { className: 'text-4xl' }, 'üõ°Ô∏è'),
                                    h('div', null,
                                        h('h1', { className: 'text-2xl font-bold' }, 'Admin Portal'),
                                        h('p', { className: 'text-slate-300 text-sm' }, 'Arizona Mushroom Study Management')
                                    )
                                ),
                                h('div', { className: 'grid grid-cols-4 gap-6 text-center' },
                                    h('div', null,
                                        h('div', { className: 'text-3xl font-bold text-blue-400' }, stats.total),
                                        h('div', { className: 'text-xs text-slate-400' }, 'Total')
                                    ),
                                    h('div', null,
                                        h('div', { className: 'text-3xl font-bold text-orange-400' }, stats.pending),
                                        h('div', { className: 'text-xs text-slate-400' }, 'Pending')
                                    ),
                                    h('div', null,
                                        h('div', { className: 'text-3xl font-bold text-green-400' }, stats.approved),
                                        h('div', { className: 'text-xs text-slate-400' }, 'Approved')
                                    ),
                                    h('div', null,
                                        h('div', { className: 'text-3xl font-bold text-purple-400' }, stats.dnaVerified),
                                        h('div', { className: 'text-xs text-slate-400' }, 'DNA')
                                    )
                                )
                            )
                        )
                    ),

                    // Navigation
                    h('div', { className: 'bg-white border-b shadow-sm sticky top-0 z-10' },
                        h('div', { className: 'max-w-7xl mx-auto px-4' },
                            h('div', { className: 'flex gap-6' },
                                [
                                    { id: 'dashboard', label: 'Dashboard', icon: 'üìä' },
                                    { id: 'review', label: 'Review Queue', icon: '‚è≥', badge: stats.pending },
                                    { id: 'species', label: 'Species Hints', icon: 'üß¨', badge: `${stats.hintsCompleteness}%` },
                                    { id: 'specimens', label: 'All Specimens', icon: 'üçÑ' }
                                ].map(item =>
                                    h('button', {
                                        key: item.id,
                                        onClick: () => setCurrentView(item.id),
                                        className: `flex items-center gap-2 px-4 py-4 border-b-2 transition-all ${
                                            currentView === item.id 
                                                ? 'border-green-600 text-green-600 bg-green-50' 
                                                : 'border-transparent text-gray-600 hover:text-gray-800 hover:bg-gray-50'
                                        }`
                                    },
                                        h('span', null, item.icon),
                                        item.label,
                                        item.badge !== undefined && item.badge > 0 && h('span', {
                                            className: `ml-2 px-2 py-1 text-xs rounded-full ${
                                                currentView === item.id
                                                    ? 'bg-green-600 text-white'
                                                    : 'bg-gray-200 text-gray-700'
                                            }`
                                        }, item.badge)
                                    )
                                )
                            )
                        )
                    ),

                    // Main Content
                    h('main', { className: 'max-w-7xl mx-auto px-4 py-8' },
                        // Dashboard View
                        currentView === 'dashboard' && h('div', { className: 'space-y-6 fade-in' },
                            h('div', { className: 'grid md:grid-cols-4 gap-6' },
                                [
                                    { title: 'Total Specimens', value: stats.total, color: 'blue', icon: 'üçÑ' },
                                    { title: 'Unique Species', value: stats.uniqueSpecies, color: 'indigo', icon: 'üß¨' },
                                    { title: 'Hints Coverage', value: `${stats.hintsCompleteness}%`, color: 'purple', icon: 'üí°' },
                                    { title: 'Ready for Study', value: stats.approved, color: 'green', icon: '‚úÖ' }
                                ].map(stat =>
                                    h('div', {
                                        key: stat.title,
                                        className: 'bg-white rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow'
                                    },
                                        h('div', { className: 'flex justify-between items-start' },
                                            h('div', null,
                                                h('p', { className: 'text-sm text-gray-600' }, stat.title),
                                                h('p', { className: `text-3xl font-bold text-${stat.color}-600 mt-2` }, stat.value)
                                            ),
                                            h('div', { className: 'text-3xl opacity-20' }, stat.icon)
                                        )
                                    )
                                )
                            ),

                            h('div', { className: 'grid md:grid-cols-2 gap-6' },
                                // Recent Activity
                                h('div', { className: 'bg-white rounded-xl p-6 shadow-sm' },
                                    h('h3', { className: 'text-lg font-semibold mb-4' }, 'Recent Specimens'),
                                    h('div', { className: 'space-y-3' },
                                        filteredSpecimens.slice(0, 5).map(specimen =>
                                            h('div', {
                                                key: specimen.id,
                                                className: 'flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer',
                                                onClick: () => setSelectedSpecimen(specimen)
                                            },
                                                h('div', { className: 'flex-1' },
                                                    h('h4', { className: 'font-medium text-sm' }, specimen.species_name),
                                                    h('p', { className: 'text-xs text-gray-600' }, 
                                                        `${specimen.genus} ‚Ä¢ ${new Date(specimen.created_at).toLocaleDateString()}`
                                                    )
                                                ),
                                                h('div', { className: 'flex items-center gap-2' },
                                                    specimen.dna_sequenced && h('span', {
                                                        className: 'text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded'
                                                    }, 'DNA'),
                                                    h('span', {
                                                        className: `text-xs px-2 py-1 rounded ${
                                                            specimen.status === 'approved' 
                                                                ? 'bg-green-100 text-green-800' 
                                                                : 'bg-orange-100 text-orange-800'
                                                        }`
                                                    }, specimen.status)
                                                )
                                            )
                                        )
                                    )
                                ),

                                // Species Without Hints
                                h('div', { className: 'bg-white rounded-xl p-6 shadow-sm' },
                                    h('h3', { className: 'text-lg font-semibold mb-4' }, 'Species Needing Hints'),
                                    h('div', { className: 'space-y-3' },
                                        uniqueSpeciesList
                                            .filter(species => !species.hints || species.hints.length === 0)
                                            .slice(0, 5)
                                            .map(species =>
                                                h('div', {
                                                    key: species.species_name,
                                                    className: 'flex items-center justify-between p-3 bg-orange-50 rounded-lg'
                                                },
                                                    h('div', { className: 'flex-1' },
                                                        h('h4', { className: 'font-medium text-sm' }, species.species_name),
                                                        h('p', { className: 'text-xs text-gray-600' }, 
                                                            `${species.specimens.length} specimen${species.specimens.length !== 1 ? 's' : ''}`
                                                        )
                                                    ),
                                                    h('button', {
                                                        onClick: () => setSelectedSpecies(species),
                                                        className: 'px-3 py-1 bg-indigo-600 text-white rounded text-sm hover:bg-indigo-700'
                                                    }, 'Configure')
                                                )
                                            ),
                                        uniqueSpeciesList.filter(s => !s.hints || s.hints.length === 0).length === 0 &&
                                            h('p', { className: 'text-center text-gray-500 py-4' }, 
                                                '‚úÖ All species have hints configured!'
                                            )
                                    )
                                )
                            )
                        ),

                        // Review Queue View
                        currentView === 'review' && h('div', { className: 'space-y-6 fade-in' },
                            h('div', { className: 'bg-white rounded-xl shadow-sm p-6' },
                                h('div', { className: 'flex justify-between items-center mb-6' },
                                    h('h2', { className: 'text-2xl font-bold' }, 'Review Queue'),
                                    h('p', { className: 'text-gray-600' }, 
                                        `${stats.pending} specimen${stats.pending !== 1 ? 's' : ''} pending review`
                                    )
                                ),
                                stats.pending === 0 ?
                                    h('div', { className: 'text-center py-12' },
                                        h('div', { className: 'text-6xl mb-4' }, 'üéâ'),
                                        h('h3', { className: 'text-2xl font-bold mb-2' }, 'All Caught Up!'),
                                        h('p', { className: 'text-gray-600' }, 'No specimens pending review.')
                                    ) :
                                    h('div', { className: 'grid gap-4' },
                                        filteredSpecimens
                                            .filter(s => s.status === 'pending')
                                            .map(specimen => {
                                                const speciesHint = speciesHints.find(h => h.species_name === specimen.species_name);
                                                const hasHints = speciesHint && speciesHint.hints && speciesHint.hints.length > 0;
                                                
                                                return h('div', {
                                                    key: specimen.id,
                                                    className: 'border rounded-lg p-4 hover:shadow-md transition-shadow'
                                                },
                                                    h('div', { className: 'flex justify-between items-start' },
                                                        h('div', { className: 'flex-1' },
                                                            h('h3', { className: 'text-lg font-semibold' }, specimen.species_name),
                                                            h('p', { className: 'text-gray-600' }, specimen.common_name || 'No common name'),
                                                            h('div', { className: 'flex items-center gap-4 mt-2 text-sm text-gray-500' },
                                                                h('span', null, `üìç ${specimen.location}`),
                                                                h('span', null, `üìä ${Math.round((specimen.quality_score || 0) * 100)}% quality`),
                                                                specimen.dna_sequenced && h('span', { className: 'text-purple-600 font-medium' }, 'üß¨ DNA')
                                                            ),
                                                            !hasHints && h('div', {
                                                                className: 'mt-2 inline-flex items-center gap-2 px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm'
                                                            },
                                                                '‚ö†Ô∏è Missing hints - configure before approving'
                                                            )
                                                        ),
                                                        h('div', { className: 'flex gap-2' },
                                                            !hasHints && h('button', {
                                                                onClick: () => setSelectedSpecies(uniqueSpeciesList.find(s => s.species_name === specimen.species_name)),
                                                                className: 'px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700'
                                                            }, 'üí° Add Hints'),
                                                            h('button', {
                                                                onClick: () => setSelectedSpecimen(specimen),
                                                                className: 'px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700'
                                                            }, 'Review')
                                                        )
                                                    )
                                                );
                                            })
                                    )
                            )
                        ),

                        // Species Hints View
                        currentView === 'species' && h('div', { className: 'space-y-6 fade-in' },
                            h('div', { className: 'bg-white rounded-xl shadow-sm p-6' },
                                h('div', { className: 'flex justify-between items-center mb-6' },
                                    h('div', null,
                                        h('h2', { className: 'text-2xl font-bold' }, 'Species Hints Management'),
                                        h('p', { className: 'text-gray-600' }, 
                                            `${stats.speciesWithHints} of ${stats.uniqueSpecies} species have hints (${stats.hintsCompleteness}% coverage)`
                                        )
                                    ),
                                    h('div', { className: 'flex items-center gap-2' },
                                        h('input', {
                                            type: 'text',
                                            value: searchTerm,
                                            onChange: (e) => setSearchTerm(e.target.value),
                                            placeholder: 'Search species...',
                                            className: 'px-3 py-2 border rounded-lg'
                                        })
                                    )
                                ),

                                h('div', { className: 'grid gap-4' },
                                    uniqueSpeciesList
                                        .filter(species => 
                                            !searchTerm || 
                                            species.species_name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                            (species.common_name && species.common_name.toLowerCase().includes(searchTerm.toLowerCase()))
                                        )
                                        .map(species => {
                                            const hasHints = species.hints && species.hints.length > 0;
                                            const specimenCount = species.specimens.length;
                                            const dnaCount = species.specimens.filter(s => s.dna_sequenced).length;
                                            
                                            return h('div', {
                                                key: species.species_name,
                                                className: `border rounded-lg p-4 ${hasHints ? 'border-gray-200' : 'border-orange-300 bg-orange-50'}`
                                            },
                                                h('div', { className: 'flex justify-between items-start' },
                                                    h('div', { className: 'flex-1' },
                                                        h('h3', { className: 'text-lg font-semibold' }, species.species_name),
                                                        h('p', { className: 'text-gray-600' }, 
                                                            species.common_name || `Family: ${species.family}`
                                                        ),
                                                        h('div', { className: 'flex items-center gap-4 mt-2' },
                                                            h('span', { className: 'text-sm text-gray-500' }, 
                                                                `${specimenCount} specimen${specimenCount !== 1 ? 's' : ''}`
                                                            ),
                                                            dnaCount > 0 && h('span', { className: 'text-sm text-purple-600' }, 
                                                                `${dnaCount} DNA verified`
                                                            ),
                                                            hasHints && h('span', { className: 'text-sm text-green-600' }, 
                                                                `${species.hints.length} hints`
                                                            ),
                                                            species.admin_reviewed && h('span', { 
                                                                className: 'text-sm bg-green-100 text-green-800 px-2 py-1 rounded'
                                                            }, '‚úì Reviewed')
                                                        )
                                                    ),
                                                    h('div', { className: 'flex items-center gap-2' },
                                                        hasHints ? 
                                                            h('span', {
                                                                className: 'bg-green-100 text-green-800 px-3 py-1 rounded text-sm font-medium'
                                                            }, '‚úì Configured') :
                                                            h('span', {
                                                                className: 'bg-orange-100 text-orange-800 px-3 py-1 rounded text-sm font-medium'
                                                            }, '‚ö† Missing'),
                                                        h('button', {
                                                            onClick: () => setSelectedSpecies(species),
                                                            className: `px-4 py-2 rounded-lg text-white ${
                                                                hasHints 
                                                                    ? 'bg-blue-600 hover:bg-blue-700' 
                                                                    : 'bg-indigo-600 hover:bg-indigo-700'
                                                            }`
                                                        }, hasHints ? 'Edit' : 'Configure')
                                                    )
                                                )
                                            );
                                        })
                                )
                            )
                        ),

                        // All Specimens View
                        currentView === 'specimens' && h('div', { className: 'space-y-6 fade-in' },
                            h('div', { className: 'bg-white rounded-xl shadow-sm p-6' },
                                h('div', { className: 'flex justify-between items-center mb-6' },
                                    h('h2', { className: 'text-2xl font-bold' }, 'All Specimens'),
                                    h('div', { className: 'flex items-center gap-4' },
                                        h('select', {
                                            value: filterStatus,
                                            onChange: (e) => setFilterStatus(e.target.value),
                                            className: 'px-3 py-2 border rounded-lg'
                                        },
                                            h('option', { value: 'all' }, 'All Status'),
                                            h('option', { value: 'pending' }, 'Pending'),
                                            h('option', { value: 'approved' }, 'Approved')
                                        ),
                                        h('select', {
                                            value: sortBy,
                                            onChange: (e) => setSortBy(e.target.value),
                                            className: 'px-3 py-2 border rounded-lg'
                                        },
                                            h('option', { value: 'created_at' }, 'Newest First'),
                                            h('option', { value: 'species_name' }, 'Species Name'),
                                            h('option', { value: 'quality_score' }, 'Quality Score')
                                        ),
                                        h('input', {
                                            type: 'text',
                                            value: searchTerm,
                                            onChange: (e) => setSearchTerm(e.target.value),
                                            placeholder: 'Search specimens...',
                                            className: 'px-3 py-2 border rounded-lg'
                                        })
                                    )
                                ),

                                h('div', { className: 'overflow-x-auto' },
                                    h('table', { className: 'w-full' },
                                        h('thead', null,
                                            h('tr', { className: 'border-b' },
                                                h('th', { className: 'text-left p-3' }, 'Species'),
                                                h('th', { className: 'text-left p-3' }, 'Location'),
                                                h('th', { className: 'text-center p-3' }, 'Quality'),
                                                h('th', { className: 'text-center p-3' }, 'DNA'),
                                                h('th', { className: 'text-center p-3' }, 'Status'),
                                                h('th', { className: 'text-center p-3' }, 'Actions')
                                            )
                                        ),
                                        h('tbody', null,
                                            filteredSpecimens.map(specimen => {
                                                const speciesHint = speciesHints.find(h => h.species_name === specimen.species_name);
                                                const hasHints = speciesHint && speciesHint.hints && speciesHint.hints.length > 0;
                                                
                                                return h('tr', {
                                                    key: specimen.id,
                                                    className: 'border-b hover:bg-gray-50'
                                                },
                                                    h('td', { className: 'p-3' },
                                                        h('div', null,
                                                            h('div', { className: 'font-medium' }, specimen.species_name),
                                                            h('div', { className: 'text-sm text-gray-600' }, 
                                                                specimen.common_name || specimen.genus
                                                            )
                                                        )
                                                    ),
                                                    h('td', { className: 'p-3 text-sm' }, specimen.location),
                                                    h('td', { className: 'p-3 text-center' },
                                                        h('div', { className: 'inline-flex items-center gap-2' },
                                                            h('div', { className: 'w-16 bg-gray-200 rounded-full h-2' },
                                                                h('div', {
                                                                    className: 'bg-green-600 h-2 rounded-full',
                                                                    style: { width: `${(specimen.quality_score || 0) * 100}%` }
                                                                })
                                                            ),
                                                            h('span', { className: 'text-sm' }, 
                                                                `${Math.round((specimen.quality_score || 0) * 100)}%`
                                                            )
                                                        )
                                                    ),
                                                    h('td', { className: 'p-3 text-center' },
                                                        specimen.dna_sequenced ? 
                                                            h('span', { className: 'text-purple-600' }, 'üß¨') : 
                                                            h('span', { className: 'text-gray-400' }, '‚Äî')
                                                    ),
                                                    h('td', { className: 'p-3 text-center' },
                                                        h('span', {
                                                            className: `px-2 py-1 rounded text-xs font-medium ${
                                                                specimen.status === 'approved' 
                                                                    ? 'bg-green-100 text-green-800' 
                                                                    : 'bg-orange-100 text-orange-800'
                                                            }`
                                                        }, specimen.status)
                                                    ),
                                                    h('td', { className: 'p-3 text-center' },
                                                        h('div', { className: 'flex justify-center gap-2' },
                                                            !hasHints && specimen.status === 'pending' && h('button', {
                                                                onClick: () => setSelectedSpecies(uniqueSpeciesList.find(s => s.species_name === specimen.species_name)),
                                                                className: 'text-indigo-600 hover:text-indigo-800',
                                                                title: 'Add hints'
                                                            }, 'üí°'),
                                                            h('button', {
                                                                onClick: () => setSelectedSpecimen(specimen),
                                                                className: 'text-blue-600 hover:text-blue-800'
                                                            }, 'üëÅÔ∏è')
                                                        )
                                                    )
                                                );
                                            })
                                        )
                                    )
                                )
                            )
                        )
                    ),

                    // Modals
                    selectedSpecimen && h(SpecimenReviewModal, {
                        specimen: selectedSpecimen,
                        speciesHints: speciesHints.find(h => h.species_name === selectedSpecimen.species_name),
                        onClose: () => setSelectedSpecimen(null),
                        onApprove: handleApproveSpecimen,
                        onDelete: handleDeleteSpecimen,
                        onUpdatePhotos: handleUpdatePhotos
                    }),

                    selectedSpecies && h(SpeciesHintsManager, {
                        species: selectedSpecies,
                        specimens: specimens,
                        onClose: () => setSelectedSpecies(null),
                        onSave: handleSaveSpeciesHints
                    }),

                    // Toast Notifications
                    toast && h(Toast, {
                        message: toast.message,
                        type: toast.type,
                        onClose: () => setToast(null)
                    })
                );
            }

            // Render the app
            try {
                const root = ReactDOM.createRoot(document.getElementById('admin-root'));
                root.render(h(AdminPortal));
                console.log('‚úÖ Admin portal initialized successfully');
            } catch (error) {
                console.error('‚ùå Error rendering admin portal:', error);
            }
        }
    </script>
</body>
</html>