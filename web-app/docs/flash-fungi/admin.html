<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flash Fungi - Admin Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <style>
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .skeleton { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: loading 1.5s infinite; }
        @keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        .phase3-indicator { 
            background: linear-gradient(45deg, #8b5cf6, #06b6d4); 
            background-size: 200% 200%; 
            animation: shimmer 2s ease-in-out infinite alternate;
        }
        @keyframes shimmer { 
            0% { background-position: 0% 50%; } 
            100% { background-position: 100% 50%; } 
        }
    </style>
</head>
<body>
    <div id="admin-root">
        <div class="min-h-screen bg-gray-50 flex items-center justify-center">
            <div class="text-center">
                <div class="text-6xl mb-4">üçÑ</div>
                <h1 class="text-2xl font-bold text-gray-800 mb-2">Admin Portal Loading...</h1>
                <p class="text-gray-600">Initializing Phase 3 ready management system...</p>
            </div>
        </div>
    </div>

    <script>
        // Wait for React to load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(initializeAdminPortal, 100);
        });

        function initializeAdminPortal() {
            if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
                console.error('React libraries not loaded');
                return;
            }

            const { useState, useEffect, useCallback, useMemo } = React;
            const h = React.createElement;
            
            // Configuration
            const SUPABASE_URL = 'https://oxgedcncrettasrbmwsl.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im94Z2VkY25jcmV0dGFzcmJtd3NsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5MDY4NjQsImV4cCI6MjA2OTQ4Mjg2NH0.mu0Cb6qRr4cja0vsSzIuLwDTtNFuimWUwNs_JbnO3Pg';
            const API_BASE = '/api';

            // Utility Functions
            const debounce = (func, wait) => {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            };

            // Toast Notification Component
            function Toast({ message, type, onClose }) {
                useEffect(() => {
                    const timer = setTimeout(onClose, 3000);
                    return () => clearTimeout(timer);
                }, [onClose]);

                const bgColor = type === 'success' ? 'bg-green-500' : 
                               type === 'error' ? 'bg-red-500' : 'bg-blue-500';

                return h('div', { 
                    className: `fixed bottom-4 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg fade-in z-50`
                },
                    h('div', { className: 'flex items-center gap-2' },
                        h('span', null, message),
                        h('button', { onClick: onClose, className: 'ml-2 text-white/80 hover:text-white' }, '√ó')
                    )
                );
            }

            // Phase 3 Feature Badge Component
            function Phase3Badge({ label }) {
                return h('span', {
                    className: 'inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium text-white phase3-indicator'
                },
                    h('span', null, '‚ú®'),
                    label || 'Phase 3 Ready'
                );
            }

            // Module Content Editor Component
            function ModuleContentEditor({ module, onSave, onClose }) {
                const [content, setContent] = useState(module.content || {});
                const [saving, setSaving] = useState(false);
                
                const handleContentChange = (section, field, value) => {
                    setContent(prev => ({
                        ...prev,
                        [section]: {
                            ...prev[section],
                            [field]: value
                        }
                    }));
                };
                
                const handleAddPage = (section) => {
                    setContent(prev => ({
                        ...prev,
                        [section]: {
                            ...prev[section],
                            pages: [...(prev[section]?.pages || []), {
                                title: '',
                                content: '',
                                image: ''
                            }]
                        }
                    }));
                };

                const handleDeletePage = (section, idx) => {
                    setContent(prev => ({
                        ...prev,
                        [section]: {
                            ...prev[section],
                            pages: prev[section].pages.filter((_, i) => i !== idx)
                        }
                    }));
                };
                
                const handleSave = async () => {
                    setSaving(true);
                    try {
                        // Check if module exists in database
                        const checkResponse = await fetch(
                            `${SUPABASE_URL}/rest/v1/training_modules?id=eq.${module.id}`,
                            {
                                headers: {
                                    'apikey': SUPABASE_ANON_KEY,
                                    'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                                }
                            }
                        );
                        
                        const existing = await checkResponse.json();
                        const method = existing.length > 0 ? 'PATCH' : 'POST';
                        const url = existing.length > 0 
                            ? `${SUPABASE_URL}/rest/v1/training_modules?id=eq.${module.id}`
                            : `${SUPABASE_URL}/rest/v1/training_modules`;
                        
                        const body = existing.length > 0 
                            ? { content: content, updated_at: new Date().toISOString() }
                            : { 
                                id: module.id,
                                title: module.title,
                                category: module.category || 'foundation',
                                difficulty_level: module.difficulty_level,
                                duration_minutes: module.duration_minutes,
                                content: content,
                                created_at: new Date().toISOString()
                            };
                        
                        const response = await fetch(url, {
                            method: method,
                            headers: {
                                'apikey': SUPABASE_ANON_KEY,
                                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(body)
                        });
                        
                        if (response.ok) {
                            onSave(content);
                        } else {
                            throw new Error('Failed to save module');
                        }
                    } catch (error) {
                        console.error('Error saving module:', error);
                    } finally {
                        setSaving(false);
                    }
                };
                
                return h('div', {
                    className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto'
                },
                    h('div', {
                        className: 'bg-white rounded-xl max-w-4xl w-full my-8'
                    },
                        // Header
                        h('div', {
                            className: 'bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 rounded-t-xl'
                        },
                            h('div', { className: 'flex justify-between items-center' },
                                h('div', null,
                                    h('h2', { className: 'text-2xl font-bold mb-2' }, 
                                        `Edit Module: ${module.title}`
                                    ),
                                    h('p', { className: 'opacity-90' }, 
                                        `${module.difficulty_level} ‚Ä¢ ${module.duration_minutes} min`
                                    )
                                ),
                                h('button', {
                                    onClick: onClose,
                                    className: 'text-white hover:text-gray-200 text-2xl'
                                }, '√ó')
                            )
                        ),
                        
                        // Content Editor
                        h('div', {
                            className: 'max-h-[60vh] overflow-y-auto p-6'
                        },
                            // Introduction Section
                            h('div', { className: 'mb-6' },
                                h('h3', { className: 'text-lg font-semibold mb-3' }, 
                                    'üìñ Introduction Pages'
                                ),
                                h('div', { className: 'space-y-3' },
                                    (content.introduction?.pages || []).map((page, idx) =>
                                        h('div', {
                                            key: idx,
                                            className: 'border rounded-lg p-4 bg-gray-50'
                                        },
                                            h('div', { className: 'flex justify-between items-start mb-2' },
                                                h('span', { className: 'text-sm font-medium text-gray-600' }, 
                                                    `Page ${idx + 1}`
                                                ),
                                                h('button', {
                                                    onClick: () => handleDeletePage('introduction', idx),
                                                    className: 'text-red-500 hover:text-red-700 text-sm'
                                                }, 'Delete')
                                            ),
                                            h('input', {
                                                type: 'text',
                                                value: page.title,
                                                onChange: (e) => {
                                                    const newPages = [...content.introduction.pages];
                                                    newPages[idx].title = e.target.value;
                                                    handleContentChange('introduction', 'pages', newPages);
                                                },
                                                placeholder: 'Page title',
                                                className: 'w-full mb-2 px-3 py-2 border rounded'
                                            }),
                                            h('textarea', {
                                                value: page.content,
                                                onChange: (e) => {
                                                    const newPages = [...content.introduction.pages];
                                                    newPages[idx].content = e.target.value;
                                                    handleContentChange('introduction', 'pages', newPages);
                                                },
                                                placeholder: 'Page content (supports markdown)',
                                                className: 'w-full px-3 py-2 border rounded',
                                                rows: 4
                                            }),
                                            h('input', {
                                                type: 'text',
                                                value: page.image,
                                                onChange: (e) => {
                                                    const newPages = [...content.introduction.pages];
                                                    newPages[idx].image = e.target.value;
                                                    handleContentChange('introduction', 'pages', newPages);
                                                },
                                                placeholder: 'Image emoji or URL',
                                                className: 'w-full mt-2 px-3 py-2 border rounded'
                                            })
                                        )
                                    ),
                                    h('button', {
                                        onClick: () => handleAddPage('introduction'),
                                        className: 'mt-3 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700'
                                    }, '+ Add Page')
                                )
                            ),
                            
                            // Quiz Questions Section
                            h('div', { className: 'mb-6' },
                                h('h3', { className: 'text-lg font-semibold mb-3' }, 
                                    '‚ùì Assessment Questions'
                                ),
                                h('div', { className: 'space-y-3' },
                                    (content.assessment?.questions || []).map((q, idx) =>
                                        h('div', {
                                            key: idx,
                                            className: 'border rounded-lg p-4 bg-gray-50'
                                        },
                                            h('div', { className: 'flex justify-between items-start mb-2' },
                                                h('span', { className: 'text-sm font-medium text-gray-600' }, 
                                                    `Question ${idx + 1}`
                                                ),
                                                h('button', {
                                                    onClick: () => {
                                                        const newQuestions = content.assessment.questions.filter((_, i) => i !== idx);
                                                        handleContentChange('assessment', 'questions', newQuestions);
                                                    },
                                                    className: 'text-red-500 hover:text-red-700 text-sm'
                                                }, 'Delete')
                                            ),
                                            h('input', {
                                                type: 'text',
                                                value: q.question,
                                                onChange: (e) => {
                                                    const newQuestions = [...content.assessment.questions];
                                                    newQuestions[idx].question = e.target.value;
                                                    handleContentChange('assessment', 'questions', newQuestions);
                                                },
                                                placeholder: 'Question',
                                                className: 'w-full mb-2 px-3 py-2 border rounded'
                                            }),
                                            h('div', { className: 'grid grid-cols-2 gap-2' },
                                                (q.options || ['', '', '', '']).map((opt, optIdx) =>
                                                    h('input', {
                                                        key: optIdx,
                                                        type: 'text',
                                                        value: opt,
                                                        onChange: (e) => {
                                                            const newQuestions = [...content.assessment.questions];
                                                            if (!newQuestions[idx].options) {
                                                                newQuestions[idx].options = ['', '', '', ''];
                                                            }
                                                            newQuestions[idx].options[optIdx] = e.target.value;
                                                            handleContentChange('assessment', 'questions', newQuestions);
                                                        },
                                                        placeholder: `Option ${optIdx + 1}`,
                                                        className: `px-3 py-2 border rounded ${
                                                            q.correct === optIdx ? 'bg-green-100 border-green-500' : ''
                                                        }`
                                                    })
                                                )
                                            ),
                                            h('select', {
                                                value: q.correct || 0,
                                                onChange: (e) => {
                                                    const newQuestions = [...content.assessment.questions];
                                                    newQuestions[idx].correct = parseInt(e.target.value);
                                                    handleContentChange('assessment', 'questions', newQuestions);
                                                },
                                                className: 'mt-2 px-3 py-2 border rounded'
                                            },
                                                h('option', { value: -1 }, 'Select correct answer'),
                                                [0, 1, 2, 3].map(i =>
                                                    h('option', { key: i, value: i }, `Option ${i + 1}`)
                                                )
                                            )
                                        )
                                    ),
                                    h('button', {
                                        onClick: () => {
                                            const newQuestions = [...(content.assessment?.questions || []), {
                                                question: '',
                                                options: ['', '', '', ''],
                                                correct: 0
                                            }];
                                            handleContentChange('assessment', 'questions', newQuestions);
                                        },
                                        className: 'mt-3 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700'
                                    }, '+ Add Question')
                                )
                            )
                        ),
                        
                        // Footer
                        h('div', {
                            className: 'border-t p-6 bg-gray-50 flex justify-between rounded-b-xl'
                        },
                            h('button', {
                                onClick: onClose,
                                className: 'px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-100'
                            }, 'Cancel'),
                            h('button', {
                                onClick: handleSave,
                                disabled: saving,
                                className: 'px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50'
                            }, saving ? 'Saving...' : 'Save Module')
                        )
                    )
                );
            }

            // Field Guide Editor Component (Preserved from original)
            function FieldGuideEditor({ species, specimens, allPhotos, onClose, onSave }) {
                // Initialize state with existing field guide data or defaults
                const [fieldGuide, setFieldGuide] = useState({
                    species_name: species.species_name,
                    description: species.description || '',
                    ecology: species.ecology || '',
                    reference_photos: species.reference_photos || [],
                    hints: species.hints || [
                        { type: 'morphological', level: 1, text: '' },
                        { type: 'comparative', level: 2, text: '' },
                        { type: 'ecological', level: 3, text: '' },
                        { type: 'taxonomic', level: 4, text: '' }
                    ],
                    diagnostic_features: species.diagnostic_features || {
                        cap: { shape: '', color: '', texture: '', size_range: '' },
                        gills_pores: { type: '', attachment: '', spacing: '', color: '' },
                        stem: { ring_presence: '', base_structure: '', texture: '' },
                        spore_print: { color: '', collection_method: '' },
                        chemical_reactions: { tests: [] }
                    },
                    comparison_species: species.comparison_species || []
                });

                const [activeTab, setActiveTab] = useState('overview');
                const [photoSelector, setPhotoSelector] = useState(false);
                const [customUrl, setCustomUrl] = useState('');
                const [saving, setSaving] = useState(false);

                // Get specimens of this species
                const speciesSpecimens = specimens.filter(s => s.species_name === species.species_name);
                const dnaVerifiedCount = speciesSpecimens.filter(s => s.dna_sequenced).length;

                // Handle photo selection
                const handleAddPhoto = (photo) => {
                    if (fieldGuide.reference_photos.length < 6) {
                        setFieldGuide(prev => ({
                            ...prev,
                            reference_photos: [...prev.reference_photos, photo]
                        }));
                    }
                };

                const handleRemovePhoto = (index) => {
                    setFieldGuide(prev => ({
                        ...prev,
                        reference_photos: prev.reference_photos.filter((_, i) => i !== index)
                    }));
                };

                const handleAddCustomUrl = () => {
                    if (customUrl && fieldGuide.reference_photos.length < 6) {
                        handleAddPhoto({
                            type: 'external',
                            url: customUrl,
                            source: 'Custom URL'
                        });
                        setCustomUrl('');
                    }
                };

                // Update hint
                const updateHint = (index, text) => {
                    const newHints = [...fieldGuide.hints];
                    newHints[index] = { ...newHints[index], text };
                    setFieldGuide(prev => ({ ...prev, hints: newHints }));
                };

                // Update diagnostic features
                const updateDiagnostic = (category, field, value) => {
                    setFieldGuide(prev => ({
                        ...prev,
                        diagnostic_features: {
                            ...prev.diagnostic_features,
                            [category]: {
                                ...prev.diagnostic_features[category],
                                [field]: value
                            }
                        }
                    }));
                };

                // Save field guide
                const handleSave = async () => {
                    setSaving(true);
                    try {
                        // Check if field guide exists
                        const checkResponse = await fetch(
                            `${SUPABASE_URL}/rest/v1/field_guides?species_name=eq.${encodeURIComponent(species.species_name)}`,
                            {
                                headers: {
                                    'apikey': SUPABASE_ANON_KEY,
                                    'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                                }
                            }
                        );

                        const existing = await checkResponse.json();
                        const method = existing.length > 0 ? 'PATCH' : 'POST';
                        const url = existing.length > 0 
                            ? `${SUPABASE_URL}/rest/v1/field_guides?species_name=eq.${encodeURIComponent(species.species_name)}`
                            : `${SUPABASE_URL}/rest/v1/field_guides`;

                        const response = await fetch(url, {
                            method: method,
                            headers: {
                                'apikey': SUPABASE_ANON_KEY,
                                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(fieldGuide)
                        });

                        if (response.ok) {
                            onSave(fieldGuide);
                            onClose();
                        } else {
                            throw new Error('Failed to save field guide');
                        }
                    } catch (error) {
                        console.error('Error saving field guide:', error);
                    } finally {
                        setSaving(false);
                    }
                };

                return h('div', { className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50' },
                    h('div', { className: 'bg-white rounded-xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col' },
                        // Header
                        h('div', { className: 'bg-gradient-to-r from-emerald-600 to-green-600 text-white p-6' },
                            h('div', { className: 'flex justify-between items-start' },
                                h('div', null,
                                    h('h2', { className: 'text-2xl font-bold mb-2' }, 
                                        `Field Guide: ${species.species_name}`
                                    ),
                                    h('div', { className: 'flex gap-4 text-sm opacity-90' },
                                        h('span', null, `${speciesSpecimens.length} specimens`),
                                        dnaVerifiedCount > 0 && h('span', null, `${dnaVerifiedCount} DNA verified`),
                                        h('span', null, `Family: ${species.family || 'Unknown'}`)
                                    )
                                ),
                                h('button', {
                                    onClick: onClose,
                                    className: 'text-white hover:text-gray-200 text-2xl'
                                }, '√ó')
                            )
                        ),

                        // Tabs
                        h('div', { className: 'border-b bg-gray-50' },
                            h('div', { className: 'flex gap-4 px-6' },
                                ['overview', 'photos', 'diagnostic', 'hints', 'comparison'].map(tab =>
                                    h('button', {
                                        key: tab,
                                        onClick: () => setActiveTab(tab),
                                        className: `py-3 px-4 border-b-2 transition-colors capitalize ${
                                            activeTab === tab 
                                                ? 'border-green-600 text-green-600 font-medium' 
                                                : 'border-transparent text-gray-600 hover:text-gray-800'
                                        }`
                                    }, tab === 'photos' ? 'üì∏ Photos' : tab)
                                )
                            )
                        ),

                        // Content
                        h('div', { className: 'flex-1 overflow-y-auto p-6' },
                            // Overview Tab
                            activeTab === 'overview' && h('div', { className: 'space-y-6' },
                                h('div', null,
                                    h('label', { className: 'block text-sm font-medium mb-2' }, 'Description'),
                                    h('textarea', {
                                        value: fieldGuide.description,
                                        onChange: (e) => setFieldGuide(prev => ({ ...prev, description: e.target.value })),
                                        placeholder: 'Comprehensive species description...',
                                        className: 'w-full p-3 border rounded-lg',
                                        rows: 6
                                    })
                                ),
                                h('div', null,
                                    h('label', { className: 'block text-sm font-medium mb-2' }, 'Ecology & Habitat'),
                                    h('textarea', {
                                        value: fieldGuide.ecology,
                                        onChange: (e) => setFieldGuide(prev => ({ ...prev, ecology: e.target.value })),
                                        placeholder: 'Habitat, substrate, seasonal patterns, geographic distribution...',
                                        className: 'w-full p-3 border rounded-lg',
                                        rows: 4
                                    })
                                )
                            ),

                            // Photos Tab
                            activeTab === 'photos' && h('div', { className: 'space-y-6' },
                                h('div', { className: 'flex justify-between items-center mb-4' },
                                    h('h3', { className: 'text-lg font-semibold' }, 
                                        `Reference Photos (${fieldGuide.reference_photos.length}/6)`
                                    ),
                                    h('button', {
                                        onClick: () => setPhotoSelector(!photoSelector),
                                        disabled: fieldGuide.reference_photos.length >= 6,
                                        className: `px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 ${
                                            fieldGuide.reference_photos.length >= 6 ? 'cursor-not-allowed' : ''
                                        }`
                                    }, '+ Add Photo')
                                ),

                                // Selected Photos
                                fieldGuide.reference_photos.length > 0 ?
                                    h('div', { className: 'grid grid-cols-3 gap-4' },
                                        fieldGuide.reference_photos.map((photo, idx) =>
                                            h('div', { key: idx, className: 'relative border rounded-lg overflow-hidden' },
                                                h('img', {
                                                    src: photo.url,
                                                    alt: `Reference ${idx + 1}`,
                                                    className: 'w-full h-48 object-cover'
                                                }),
                                                h('div', { className: 'absolute top-2 right-2' },
                                                    h('button', {
                                                        onClick: () => handleRemovePhoto(idx),
                                                        className: 'bg-red-500 text-white rounded-full p-1 hover:bg-red-600'
                                                    }, '√ó')
                                                ),
                                                h('div', { className: 'p-2 bg-white' },
                                                    h('p', { className: 'text-xs text-gray-600' }, photo.source),
                                                    photo.inaturalist_id && h('a', {
                                                        href: `https://www.inaturalist.org/observations/${photo.inaturalist_id}`,
                                                        target: '_blank',
                                                        className: 'text-xs text-blue-600 hover:underline'
                                                    }, 'View on iNaturalist ‚Üí')
                                                )
                                            )
                                        )
                                    ) :
                                    h('div', { className: 'text-center py-8 bg-gray-50 rounded-lg' },
                                        h('p', { className: 'text-gray-600' }, 'No reference photos selected')
                                    ),

                                // Photo Selector
                                photoSelector && h('div', { className: 'border-t pt-4 mt-4' },
                                    h('h4', { className: 'font-medium mb-3' }, 'Add Reference Photo'),
                                    
                                    // Custom URL Input
                                    h('div', { className: 'mb-4' },
                                        h('label', { className: 'block text-sm font-medium mb-2' }, 'External URL'),
                                        h('div', { className: 'flex gap-2' },
                                            h('input', {
                                                type: 'url',
                                                value: customUrl,
                                                onChange: (e) => setCustomUrl(e.target.value),
                                                placeholder: 'https://example.com/mushroom.jpg',
                                                className: 'flex-1 px-3 py-2 border rounded-lg'
                                            }),
                                            h('button', {
                                                onClick: handleAddCustomUrl,
                                                className: 'px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700'
                                            }, 'Add URL')
                                        )
                                    ),

                                    // Specimen Photos
                                    h('div', null,
                                        h('label', { className: 'block text-sm font-medium mb-2' }, 
                                            'Or select from specimen photos'
                                        ),
                                        h('div', { className: 'grid grid-cols-4 gap-2 max-h-64 overflow-y-auto' },
                                            allPhotos
                                                .filter(photo => !fieldGuide.reference_photos.some(rp => 
                                                    rp.url === photo.url
                                                ))
                                                .map((photo, idx) =>
                                                    h('div', {
                                                        key: idx,
                                                        onClick: () => handleAddPhoto(photo),
                                                        className: 'cursor-pointer border-2 border-transparent hover:border-blue-500 rounded'
                                                    },
                                                        h('img', {
                                                            src: photo.url,
                                                            alt: `Option ${idx}`,
                                                            className: 'w-full h-24 object-cover rounded'
                                                        })
                                                    )
                                                )
                                        )
                                    )
                                )
                            ),

                            // Diagnostic Features Tab
                            activeTab === 'diagnostic' && h('div', { className: 'space-y-6' },
                                h('h3', { className: 'text-lg font-semibold mb-4' }, 'Diagnostic Features'),
                                
                                // Cap Features
                                h('div', { className: 'bg-gray-50 rounded-lg p-4' },
                                    h('h4', { className: 'font-medium mb-3' }, 'üçÑ Cap Features'),
                                    h('div', { className: 'grid grid-cols-2 gap-3' },
                                        ['shape', 'color', 'texture', 'size_range'].map(field =>
                                            h('div', { key: field },
                                                h('label', { className: 'block text-sm font-medium mb-1 capitalize' }, 
                                                    field.replace('_', ' ')
                                                ),
                                                h('input', {
                                                    type: 'text',
                                                    value: fieldGuide.diagnostic_features.cap[field],
                                                    onChange: (e) => updateDiagnostic('cap', field, e.target.value),
                                                    className: 'w-full px-3 py-2 border rounded-lg text-sm'
                                                })
                                            )
                                        )
                                    )
                                ),

                                // Gills/Pores Features
                                h('div', { className: 'bg-gray-50 rounded-lg p-4' },
                                    h('h4', { className: 'font-medium mb-3' }, 'üìè Gills/Pores Features'),
                                    h('div', { className: 'grid grid-cols-2 gap-3' },
                                        ['type', 'attachment', 'spacing', 'color'].map(field =>
                                            h('div', { key: field },
                                                h('label', { className: 'block text-sm font-medium mb-1 capitalize' }, field),
                                                h('input', {
                                                    type: 'text',
                                                    value: fieldGuide.diagnostic_features.gills_pores[field],
                                                    onChange: (e) => updateDiagnostic('gills_pores', field, e.target.value),
                                                    placeholder: field === 'type' ? 'gills/pores/teeth' : '',
                                                    className: 'w-full px-3 py-2 border rounded-lg text-sm'
                                                })
                                            )
                                        )
                                    )
                                ),

                                // Stem Features
                                h('div', { className: 'bg-gray-50 rounded-lg p-4' },
                                    h('h4', { className: 'font-medium mb-3' }, 'ü¶¥ Stem Features'),
                                    h('div', { className: 'grid grid-cols-3 gap-3' },
                                        ['ring_presence', 'base_structure', 'texture'].map(field =>
                                            h('div', { key: field },
                                                h('label', { className: 'block text-sm font-medium mb-1 capitalize' }, 
                                                    field.replace('_', ' ')
                                                ),
                                                h('input', {
                                                    type: 'text',
                                                    value: fieldGuide.diagnostic_features.stem[field],
                                                    onChange: (e) => updateDiagnostic('stem', field, e.target.value),
                                                    className: 'w-full px-3 py-2 border rounded-lg text-sm'
                                                })
                                            )
                                        )
                                    )
                                ),

                                // Spore Print
                                h('div', { className: 'bg-gray-50 rounded-lg p-4' },
                                    h('h4', { className: 'font-medium mb-3' }, 'üé® Spore Print'),
                                    h('div', { className: 'grid grid-cols-2 gap-3' },
                                        h('div', null,
                                            h('label', { className: 'block text-sm font-medium mb-1' }, 'Color'),
                                            h('input', {
                                                type: 'text',
                                                value: fieldGuide.diagnostic_features.spore_print.color,
                                                onChange: (e) => updateDiagnostic('spore_print', 'color', e.target.value),
                                                className: 'w-full px-3 py-2 border rounded-lg text-sm'
                                            })
                                        ),
                                        h('div', null,
                                            h('label', { className: 'block text-sm font-medium mb-1' }, 'Collection Method'),
                                            h('input', {
                                                type: 'text',
                                                value: fieldGuide.diagnostic_features.spore_print.collection_method,
                                                onChange: (e) => updateDiagnostic('spore_print', 'collection_method', e.target.value),
                                                className: 'w-full px-3 py-2 border rounded-lg text-sm'
                                            })
                                        )
                                    )
                                )
                            ),

                            // Hints Tab
                            activeTab === 'hints' && h('div', { className: 'space-y-6' },
                                h('h3', { className: 'text-lg font-semibold mb-4' }, 'Progressive Hints'),
                                h('p', { className: 'text-sm text-gray-600 mb-4' }, 
                                    'These hints are revealed progressively when students answer incorrectly.'
                                ),
                                
                                fieldGuide.hints.map((hint, idx) => {
                                    const hintTypes = {
                                        'morphological': { icon: 'üîç', color: 'green', label: 'Morphological (Physical Features)' },
                                        'comparative': { icon: '‚öñÔ∏è', color: 'blue', label: 'Comparative (Similar Species)' },
                                        'ecological': { icon: 'üå≤', color: 'emerald', label: 'Ecological (Habitat/Context)' },
                                        'taxonomic': { icon: 'üìö', color: 'purple', label: 'Taxonomic (Classification)' }
                                    };
                                    const type = hintTypes[hint.type];
                                    
                                    return h('div', { 
                                        key: idx, 
                                        className: `border rounded-lg p-4 bg-${type.color}-50 border-${type.color}-200`
                                    },
                                        h('div', { className: 'flex items-center gap-2 mb-2' },
                                            h('span', { className: 'text-2xl' }, type.icon),
                                            h('span', { className: 'font-medium' }, `Level ${hint.level}: ${type.label}`)
                                        ),
                                        h('textarea', {
                                            value: hint.text,
                                            onChange: (e) => updateHint(idx, e.target.value),
                                            placeholder: `Enter ${hint.type} hint...`,
                                            className: 'w-full px-3 py-2 border rounded-lg text-sm',
                                            rows: 3
                                        })
                                    );
                                })
                            ),

                            // Comparison Tab
                            activeTab === 'comparison' && h('div', { className: 'space-y-6' },
                                h('h3', { className: 'text-lg font-semibold mb-4' }, 'Similar Species & Look-Alikes'),
                                h('p', { className: 'text-sm text-gray-600 mb-4' }, 
                                    'Add species that are commonly confused with this one.'
                                ),
                                h('div', { className: 'bg-yellow-50 border border-yellow-200 rounded-lg p-4' },
                                    h('p', { className: 'text-sm text-yellow-800' }, 
                                        '‚ö†Ô∏è This feature will be expanded in Phase 3 with side-by-side comparisons and safety warnings.'
                                    )
                                )
                            )
                        ),

                        // Footer
                        h('div', { className: 'border-t p-6 bg-gray-50' },
                            h('div', { className: 'flex justify-between items-center' },
                                h('div', { className: 'text-sm text-gray-600' },
                                    h('span', null, 
                                        `${fieldGuide.hints.filter(h => h.text).length}/4 hints configured ‚Ä¢ ` +
                                        `${fieldGuide.reference_photos.length}/6 photos`
                                    )
                                ),
                                h('div', { className: 'flex gap-3' },
                                    h('button', {
                                        onClick: onClose,
                                        className: 'px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-100'
                                    }, 'Cancel'),
                                    h('button', {
                                        onClick: handleSave,
                                        disabled: saving,
                                        className: 'px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50'
                                    }, saving ? 'Saving...' : 'üíæ Save Field Guide')
                                )
                            )
                        )
                    )
                );
            }

            // Specimen Review Modal (Preserved from original)
            function SpecimenReviewModal({ specimen, onClose, onApprove, onDelete }) {
                const [notes, setNotes] = useState(specimen.admin_notes || '');
                const [selectedPhotos, setSelectedPhotos] = useState(specimen.selected_photos || []);
                const [photos, setPhotos] = useState([]);
                const [loadingPhotos, setLoadingPhotos] = useState(true);

                useEffect(() => {
                    loadPhotos();
                }, []);

                const loadPhotos = async () => {
                    try {
                        const response = await fetch(`https://api.inaturalist.org/v1/observations/${specimen.inaturalist_id}`);
                        const data = await response.json();
                        if (data.results && data.results[0] && data.results[0].photos) {
                            setPhotos(data.results[0].photos);
                            if (selectedPhotos.length === 0) {
                                setSelectedPhotos(data.results[0].photos.map(p => p.id));
                            }
                        }
                    } catch (error) {
                        console.error('Error loading photos:', error);
                    } finally {
                        setLoadingPhotos(false);
                    }
                };

                const togglePhotoSelection = (photoId) => {
                    setSelectedPhotos(prev => 
                        prev.includes(photoId) 
                            ? prev.filter(id => id !== photoId)
                            : [...prev, photoId]
                    );
                };

                return h('div', { className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50' },
                    h('div', { className: 'bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col' },
                        // Header
                        h('div', { className: 'bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-6' },
                            h('div', { className: 'flex justify-between items-start' },
                                h('div', null,
                                    h('h2', { className: 'text-2xl font-bold mb-2' }, specimen.species_name),
                                    h('div', { className: 'flex items-center gap-4 text-sm opacity-90' },
                                        specimen.common_name && h('span', null, specimen.common_name),
                                        h('span', null, `Family: ${specimen.family}`),
                                        specimen.dna_sequenced && h('span', { className: 'bg-white/20 px-2 py-1 rounded' }, 'üß¨ DNA')
                                    )
                                ),
                                h('button', {
                                    onClick: onClose,
                                    className: 'text-white hover:text-gray-200 text-2xl'
                                }, '√ó')
                            )
                        ),

                        // Content
                        h('div', { className: 'flex-1 overflow-y-auto p-6' },
                            h('div', { className: 'grid md:grid-cols-2 gap-6' },
                                // Specimen Info
                                h('div', null,
                                    h('h3', { className: 'font-semibold mb-3' }, 'Specimen Information'),
                                    h('div', { className: 'bg-gray-50 rounded-lg p-4 space-y-2 text-sm' },
                                        h('p', null, h('strong', null, 'Location: '), specimen.location),
                                        specimen.description && h('p', null, h('strong', null, 'Description: '), specimen.description),
                                        h('p', null, h('strong', null, 'Quality Score: '), 
                                            `${Math.round((specimen.quality_score || 0) * 100)}%`
                                        ),
                                        h('p', null,
                                            h('a', {
                                                href: `https://www.inaturalist.org/observations/${specimen.inaturalist_id}`,
                                                target: '_blank',
                                                className: 'text-blue-600 hover:text-blue-800'
                                            }, 'View on iNaturalist ‚Üí')
                                        )
                                    )
                                ),

                                // Admin Notes
                                h('div', null,
                                    h('h3', { className: 'font-semibold mb-3' }, 'Admin Notes'),
                                    h('textarea', {
                                        value: notes,
                                        onChange: (e) => setNotes(e.target.value),
                                        placeholder: 'Add notes about this specimen...',
                                        className: 'w-full p-3 border rounded-lg resize-none',
                                        rows: 5
                                    })
                                )
                            ),

                            // Photo Selection
                            h('div', { className: 'mt-6' },
                                h('h3', { className: 'font-semibold mb-3' }, 
                                    `Photo Selection (${selectedPhotos.length} selected)`
                                ),
                                loadingPhotos ? 
                                    h('p', { className: 'text-gray-600' }, 'Loading photos...') :
                                    photos.length > 0 ?
                                        h('div', { className: 'grid grid-cols-4 gap-2' },
                                            photos.map(photo => 
                                                h('div', {
                                                    key: photo.id,
                                                    className: `relative border-2 rounded-lg overflow-hidden cursor-pointer ${
                                                        selectedPhotos.includes(photo.id) 
                                                            ? 'border-green-500' 
                                                            : 'border-gray-200'
                                                    }`,
                                                    onClick: () => togglePhotoSelection(photo.id)
                                                },
                                                    h('img', {
                                                        src: photo.url.replace('square', 'medium'),
                                                        alt: 'Specimen photo',
                                                        className: 'w-full h-24 object-cover'
                                                    }),
                                                    selectedPhotos.includes(photo.id) && h('div', {
                                                        className: 'absolute top-1 right-1 bg-green-500 text-white rounded-full p-1'
                                                    },
                                                        h('svg', { className: 'w-4 h-4', fill: 'currentColor', viewBox: '0 0 20 20' },
                                                            h('path', { 
                                                                fillRule: 'evenodd',
                                                                d: 'M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z',
                                                                clipRule: 'evenodd'
                                                            })
                                                        )
                                                    )
                                                )
                                            )
                                        ) :
                                        h('p', { className: 'text-gray-600' }, 'No photos available')
                            )
                        ),

                        // Footer
                        h('div', { className: 'border-t p-6 bg-gray-50' },
                            h('div', { className: 'flex justify-between items-center' },
                                h('div', { className: 'text-sm text-gray-600' },
                                    `Status: ${specimen.status}`
                                ),
                                h('div', { className: 'flex gap-3' },
                                    specimen.status === 'pending' && [
                                        h('button', {
                                            key: 'delete',
                                            onClick: () => onDelete(),
                                            className: 'px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700'
                                        }, 'üóëÔ∏è Delete'),
                                        h('button', {
                                            key: 'approve',
                                            onClick: () => onApprove(notes, selectedPhotos),
                                            className: 'px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700'
                                        }, '‚úÖ Approve')
                                    ],
                                    h('button', {
                                        onClick: onClose,
                                        className: 'px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-100'
                                    }, 'Close')
                                )
                            )
                        )
                    )
                );
            }

            // Main Admin Portal Component
            function AdminPortal() {
                const [currentView, setCurrentView] = useState('dashboard');
                const [specimens, setSpecimens] = useState([]);
                const [fieldGuides, setFieldGuides] = useState([]);
                const [loading, setLoading] = useState(true);
                const [selectedSpecimen, setSelectedSpecimen] = useState(null);
                const [selectedSpecies, setSelectedSpecies] = useState(null);
                const [selectedModule, setSelectedModule] = useState(null);
                const [toast, setToast] = useState(null);
                const [searchTerm, setSearchTerm] = useState('');
                const [filterStatus, setFilterStatus] = useState('all');

                useEffect(() => {
                    loadData();
                }, []);

                const loadData = async () => {
                    try {
                        // Load specimens
                        const specimensResponse = await fetch(
                            `${SUPABASE_URL}/rest/v1/specimens?select=*&order=created_at.desc`,
                            {
                                headers: {
                                    'apikey': SUPABASE_ANON_KEY,
                                    'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                                }
                            }
                        );
                        
                        if (specimensResponse.ok) {
                            const data = await specimensResponse.json();
                            setSpecimens(data || []);
                        }

                        // Load field guides
                        const guidesResponse = await fetch(
                            `${SUPABASE_URL}/rest/v1/field_guides?select=*`,
                            {
                                headers: {
                                    'apikey': SUPABASE_ANON_KEY,
                                    'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                                }
                            }
                        );
                        
                        if (guidesResponse.ok) {
                            const guidesData = await guidesResponse.json();
                            setFieldGuides(guidesData || []);
                        }
                    } catch (error) {
                        console.error('Error loading data:', error);
                        showToast('Error loading data', 'error');
                    } finally {
                        setLoading(false);
                    }
                };

                const showToast = (message, type = 'info') => {
                    setToast({ message, type });
                };

                const handleApproveSpecimen = async (notes, selectedPhotos) => {
                    try {
                        const response = await fetch(`${API_BASE}/admin`, {
                            method: 'PATCH',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                specimenId: selectedSpecimen.id,
                                status: 'approved',
                                notes: notes,
                                selectedPhotoIds: selectedPhotos
                            })
                        });

                        if (response.ok) {
                            showToast('Specimen approved successfully', 'success');
                            setSelectedSpecimen(null);
                            loadData();
                        } else {
                            showToast('Failed to approve specimen', 'error');
                        }
                    } catch (error) {
                        console.error('Error approving specimen:', error);
                        showToast('Error approving specimen', 'error');
                    }
                };

                const handleDeleteSpecimen = async () => {
                    if (!confirm(`Delete specimen "${selectedSpecimen.species_name}"?`)) return;
                    
                    try {
                        const response = await fetch(`${API_BASE}/admin`, {
                            method: 'DELETE',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ specimenId: selectedSpecimen.id })
                        });

                        if (response.ok) {
                            showToast('Specimen deleted successfully', 'success');
                            setSelectedSpecimen(null);
                            loadData();
                        } else {
                            showToast('Failed to delete specimen', 'error');
                        }
                    } catch (error) {
                        console.error('Error deleting specimen:', error);
                        showToast('Error deleting specimen', 'error');
                    }
                };

                const handleSaveFieldGuide = (fieldGuide) => {
                    showToast('Field guide saved successfully', 'success');
                    loadData();
                };

                // Get all photos for a species
                const getAllPhotosForSpecies = (speciesName) => {
                    const photos = [];
                    const speciesSpecimens = specimens.filter(s => s.species_name === speciesName);
                    
                    for (const specimen of speciesSpecimens) {
                        if (specimen.selected_photos && specimen.selected_photos.length > 0) {
                            // This would need to be enhanced to fetch actual photo URLs
                            // For now, creating placeholder photo objects
                            specimen.selected_photos.forEach(photoId => {
                                photos.push({
                                    type: 'inaturalist',
                                    url: `https://inaturalist-open-data.s3.amazonaws.com/photos/${photoId}/medium.jpg`,
                                    inaturalist_id: specimen.inaturalist_id,
                                    source: `Specimen ${specimen.inaturalist_id}`
                                });
                            });
                        }
                    }
                    
                    return photos;
                };

                // Calculate statistics
                const stats = useMemo(() => {
                    const total = specimens.length;
                    const pending = specimens.filter(s => s.status === 'pending').length;
                    const approved = specimens.filter(s => s.status === 'approved').length;
                    const dnaVerified = specimens.filter(s => s.dna_sequenced).length;
                    const uniqueSpecies = new Set(specimens.map(s => s.species_name)).size;
                    const guidesComplete = fieldGuides.length;

                    return { total, pending, approved, dnaVerified, uniqueSpecies, guidesComplete };
                }, [specimens, fieldGuides]);

                // Get unique species list
                const uniqueSpeciesList = useMemo(() => {
                    const speciesMap = new Map();
                    specimens.forEach(s => {
                        if (!speciesMap.has(s.species_name)) {
                            speciesMap.set(s.species_name, {
                                species_name: s.species_name,
                                genus: s.genus,
                                family: s.family,
                                common_name: s.common_name,
                                specimens: []
                            });
                        }
                        speciesMap.get(s.species_name).specimens.push(s);
                    });
                    
                    return Array.from(speciesMap.values()).map(species => {
                        const guide = fieldGuides.find(g => g.species_name === species.species_name);
                        return { ...species, ...guide };
                    });
                }, [specimens, fieldGuides]);

                // Filter specimens
                const filteredSpecimens = useMemo(() => {
                    let filtered = [...specimens];
                    
                    if (searchTerm) {
                        filtered = filtered.filter(s => 
                            s.species_name.toLowerCase().includes(searchTerm.toLowerCase())
                        );
                    }
                    
                    if (filterStatus !== 'all') {
                        filtered = filtered.filter(s => s.status === filterStatus);
                    }
                    
                    return filtered;
                }, [specimens, searchTerm, filterStatus]);

                if (loading) {
                    return h('div', { className: 'min-h-screen bg-gray-50 flex items-center justify-center' },
                        h('div', { className: 'text-center' },
                            h('div', { className: 'text-6xl mb-4 animate-pulse' }, 'üçÑ'),
                            h('h1', { className: 'text-2xl font-bold text-gray-800 mb-2' }, 'Loading Admin Portal'),
                            h('p', { className: 'text-gray-600' }, 'Fetching specimens and field guides...')
                        )
                    );
                }

                return h('div', { className: 'min-h-screen bg-gray-50' },
                    // Enhanced Header with Phase 3 Indicator
                    h('div', { className: 'bg-gradient-to-r from-slate-800 to-slate-900 text-white shadow-lg' },
                        h('div', { className: 'max-w-7xl mx-auto px-4 py-6' },
                            h('div', { className: 'flex justify-between items-center' },
                                h('div', { className: 'flex items-center gap-4' },
                                    h('div', { className: 'text-4xl' }, 'üçÑ'),
                                    h('div', null,
                                        h('div', { className: 'flex items-center gap-3' },
                                            h('h1', { className: 'text-2xl font-bold' }, 'Flash Fungi Admin'),
                                            h(Phase3Badge, { label: 'Phase 3 Ready' })
                                        ),
                                        h('p', { className: 'text-slate-300 text-sm' }, 'Enhanced Management System with Training & Analytics')
                                    )
                                ),
                                h('div', { className: 'grid grid-cols-3 gap-6 text-center' },
                                    h('div', null,
                                        h('div', { className: 'text-3xl font-bold text-green-400' }, stats.approved),
                                        h('div', { className: 'text-xs text-slate-400' }, 'Approved')
                                    ),
                                    h('div', null,
                                        h('div', { className: 'text-3xl font-bold text-orange-400' }, stats.pending),
                                        h('div', { className: 'text-xs text-slate-400' }, 'Pending')
                                    ),
                                    h('div', null,
                                        h('div', { className: 'text-3xl font-bold text-blue-400' }, stats.guidesComplete),
                                        h('div', { className: 'text-xs text-slate-400' }, 'Field Guides')
                                    )
                                )
                            )
                        )
                    ),

                    // Enhanced Navigation with Phase 3 Features
                    h('div', { className: 'bg-white border-b shadow-sm sticky top-0 z-10' },
                        h('div', { className: 'max-w-7xl mx-auto px-4' },
                            h('div', { className: 'flex gap-6 overflow-x-auto' },
                                [
                                    { id: 'dashboard', label: 'Dashboard', icon: 'üìä' },
                                    { id: 'review', label: 'Review Queue', icon: '‚è≥', badge: stats.pending },
                                    { id: 'field-guides', label: 'Field Guides', icon: 'üìö', badge: stats.guidesComplete },
                                    { id: 'training-modules', label: 'Training Modules', icon: 'üéì', phase3: true },
                                    { id: 'achievements', label: 'Achievements', icon: 'üèÜ', phase3: true },
                                    { id: 'user-analytics', label: 'Analytics', icon: 'üìà', phase3: true },
                                    { id: 'specimens', label: 'All Specimens', icon: 'üî¨' }
                                ].map(item =>
                                    h('button', {
                                        key: item.id,
                                        onClick: () => setCurrentView(item.id),
                                        className: `flex items-center gap-2 px-4 py-4 border-b-2 transition-all whitespace-nowrap ${
                                            currentView === item.id 
                                                ? 'border-green-600 text-green-600 bg-green-50' 
                                                : 'border-transparent text-gray-600 hover:text-gray-800 hover:bg-gray-50'
                                        }`
                                    },
                                        h('span', null, item.icon),
                                        item.label,
                                        item.phase3 && h('span', {
                                            className: 'ml-1 px-1.5 py-0.5 text-xs rounded-full bg-purple-100 text-purple-700'
                                        }, 'NEW'),
                                        item.badge !== undefined && item.badge > 0 && h('span', {
                                            className: `ml-2 px-2 py-1 text-xs rounded-full ${
                                                currentView === item.id
                                                    ? 'bg-green-600 text-white'
                                                    : 'bg-gray-200 text-gray-700'
                                            }`
                                        }, item.badge)
                                    )
                                )
                            )
                        )
                    ),

                    // Main Content with Phase 3 Features
                    h('main', { className: 'max-w-7xl mx-auto px-4 py-8' },
                        // Dashboard View (Enhanced)
                        currentView === 'dashboard' && h('div', { className: 'space-y-6 fade-in' },
                            // Phase 3 Features Overview
                            h('div', { 
                                className: 'bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl p-6 mb-6'
                            },
                                h('div', { className: 'flex justify-between items-center' },
                                    h('div', null,
                                        h('h2', { className: 'text-2xl font-bold mb-2' }, 'üöÄ Phase 3 Enhancement Complete'),
                                        h('p', { className: 'opacity-90' }, 'Training modules, achievements, and analytics are now available!')
                                    ),
                                    h('div', { className: 'text-right' },
                                        h('div', { className: 'text-3xl font-bold' }, '3'),
                                        h('div', { className: 'text-sm opacity-75' }, 'New Sections')
                                    )
                                )
                            ),

                            h('div', { className: 'grid md:grid-cols-4 gap-6' },
                                [
                                    { title: 'Total Specimens', value: stats.total, color: 'blue', icon: 'üî¨' },
                                    { title: 'Unique Species', value: stats.uniqueSpecies, color: 'indigo', icon: 'üß¨' },
                                    { title: 'Field Guides', value: stats.guidesComplete, color: 'purple', icon: 'üìö' },
                                    { title: 'DNA Verified', value: stats.dnaVerified, color: 'green', icon: 'üß¨' }
                                ].map(stat =>
                                    h('div', {
                                        key: stat.title,
                                        className: 'bg-white rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow'
                                    },
                                        h('div', { className: 'flex justify-between items-start' },
                                            h('div', null,
                                                h('p', { className: 'text-sm text-gray-600' }, stat.title),
                                                h('p', { className: `text-3xl font-bold text-${stat.color}-600 mt-2` }, stat.value)
                                            ),
                                            h('div', { className: 'text-3xl opacity-20' }, stat.icon)
                                        )
                                    )
                                )
                            ),

                            // Quick Actions for Phase 3 Features
                            h('div', { className: 'bg-white rounded-xl shadow-sm p-6' },
                                h('h3', { className: 'text-lg font-semibold mb-4' }, '‚ö° Quick Actions'),
                                h('div', { className: 'grid md:grid-cols-3 gap-4' },
                                    [
                                        { action: 'Manage Training Content', desc: 'Edit modules and lessons', view: 'training-modules', color: 'blue' },
                                        { action: 'Review User Progress', desc: 'Analytics and insights', view: 'user-analytics', color: 'green' },
                                        { action: 'Configure Achievements', desc: 'Badges and milestones', view: 'achievements', color: 'yellow' }
                                    ].map((action, idx) =>
                                        h('button', {
                                            key: idx,
                                            onClick: () => setCurrentView(action.view),
                                            className: `text-left p-4 border rounded-lg hover:shadow-md transition-all hover:border-${action.color}-300`
                                        },
                                            h('div', { className: `font-medium text-${action.color}-700` }, action.action),
                                            h('div', { className: 'text-sm text-gray-600 mt-1' }, action.desc)
                                        )
                                    )
                                )
                            )
                        ),

                        // Training Modules Management View
                        currentView === 'training-modules' && h('div', { className: 'space-y-6 fade-in' },
                            h('div', { className: 'bg-white rounded-xl shadow-sm p-6' },
                                h('div', { className: 'flex justify-between items-center mb-6' },
                                    h('div', null,
                                        h('div', { className: 'flex items-center gap-3 mb-2' },
                                            h('h2', { className: 'text-2xl font-bold' }, 'Training Modules Management'),
                                            h(Phase3Badge)
                                        ),
                                        h('p', { className: 'text-gray-600' }, 
                                            'Manage educational content and module structure'
                                        )
                                    ),
                                    h('button', {
                                        onClick: () => showToast('Module creator coming in next update!', 'info'),
                                        className: 'px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700'
                                    }, '+ Create Module')
                                ),

                                // Module Management Grid
                                h('div', { className: 'grid md:grid-cols-2 gap-6 mb-6' },
                                    // Foundation Modules
                                    h('div', { className: 'border rounded-lg p-4 bg-gradient-to-br from-blue-50 to-indigo-50' },
                                        h('h3', { className: 'text-lg font-semibold mb-3 flex items-center gap-2' },
                                            h('span', null, 'üèóÔ∏è'),
                                            'Foundation Modules (5)',
                                            h('span', { className: 'px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full' }, 'Active')
                                        ),
                                        h('div', { className: 'space-y-2' },
                                            [
                                                { id: 'foundation-1', name: 'Basic Diagnostic Features', status: 'Published', completion: '87%' },
                                                { id: 'foundation-2', name: 'Spore Print Basics', status: 'Published', completion: '73%' },
                                                { id: 'foundation-3', name: 'Safety First: Deadly Species', status: 'Published', completion: '91%' },
                                                { id: 'foundation-4', name: 'Mycological Terminology', status: 'Draft', completion: '65%' },
                                                { id: 'foundation-5', name: 'Arizona Fungal Families', status: 'Published', completion: '58%' }
                                            ].map((module, idx) =>
                                                h('div', {
                                                    key: module.id,
                                                    className: 'flex justify-between items-center p-3 bg-white rounded border hover:shadow-sm transition-shadow'
                                                },
                                                    h('div', { className: 'flex-1' },
                                                        h('div', { className: 'font-medium text-sm' }, module.name),
                                                        h('div', { className: 'flex items-center gap-2 mt-1' },
                                                            h('span', { 
                                                                className: `px-2 py-0.5 text-xs rounded ${
                                                                    module.status === 'Published' 
                                                                        ? 'bg-green-100 text-green-700' 
                                                                        : 'bg-yellow-100 text-yellow-700'
                                                                }`
                                                            }, module.status),
                                                            h('span', { className: 'text-xs text-gray-500' }, 
                                                                `${module.completion} completion`
                                                            )
                                                        )
                                                    ),
                                                    h('div', { className: 'flex gap-1' },
                                                        h('button', { 
                                                            onClick: () => {
                                                                setSelectedModule({
                                                                    id: module.id,
                                                                    title: module.name,
                                                                    category: 'foundation',
                                                                    difficulty_level: 'beginner',
                                                                    duration_minutes: 20,
                                                                    content: {}
                                                                });
                                                            },
                                                            className: 'text-xs text-blue-600 hover:underline px-2 py-1' 
                                                        }, 'Edit Content'),
                                                        h('button', { 
                                                            onClick: () => showToast(`Previewing ${module.name}...`, 'info'),
                                                            className: 'text-xs text-purple-600 hover:underline px-2 py-1' 
                                                        }, 'Preview')
                                                    )
                                                )
                                            )
                                        )
                                    ),

                                    // Advanced Modules Planning
                                    h('div', { className: 'border-2 border-dashed border-purple-300 rounded-lg p-4 bg-gradient-to-br from-purple-50 to-pink-50' },
                                        h('h3', { className: 'text-lg font-semibold mb-3 flex items-center gap-2' },
                                            h('span', null, 'üöÄ'),
                                            'Advanced Modules',
                                            h('span', { className: 'px-2 py-1 bg-purple-100 text-purple-700 text-xs rounded-full' }, 'Planned')
                                        ),
                                        h('div', { className: 'space-y-3' },
                                            [
                                                { category: 'Genus-Specific', count: 8, desc: 'Bolete, Agaricus, Amanita, etc.' },
                                                { category: 'Advanced Techniques', count: 4, desc: 'Chemical testing, microscopy' },
                                                { category: 'Regional Specialties', count: 3, desc: 'Sky islands, desert species' },
                                                { category: 'Field Methods', count: 2, desc: 'Photography, collection ethics' }
                                            ].map((category, idx) =>
                                                h('div', {
                                                    key: idx,
                                                    className: 'p-3 bg-white rounded border border-purple-200'
                                                },
                                                    h('div', { className: 'flex justify-between items-center' },
                                                        h('div', null,
                                                            h('div', { className: 'font-medium text-sm text-purple-800' }, category.category),
                                                            h('div', { className: 'text-xs text-purple-600' }, category.desc)
                                                        ),
                                                        h('span', { className: 'text-sm font-bold text-purple-700' }, 
                                                            `${category.count} modules`
                                                        )
                                                    )
                                                )
                                            )
                                        ),
                                        h('div', { className: 'mt-4 p-2 bg-purple-100 rounded text-center' },
                                            h('p', { className: 'text-sm text-purple-700 font-medium' }, 
                                                'üìÖ Ready for Phase 3 development'
                                            )
                                        )
                                    )
                                ),

                                // Module Analytics Dashboard
                                h('div', { className: 'bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200' },
                                    h('h4', { className: 'font-semibold mb-3 flex items-center gap-2' },
                                        h('span', null, 'üìä'),
                                        'Module Performance Analytics'
                                    ),
                                    h('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-4' },
                                        [
                                            { label: 'Total Completions', value: '89', icon: '‚úÖ', color: 'green' },
                                            { label: 'Avg Session Time', value: '12.5m', icon: '‚è±Ô∏è', color: 'blue' },
                                            { label: 'User Satisfaction', value: '4.7/5', icon: '‚≠ê', color: 'yellow' },
                                            { label: 'Knowledge Retention', value: '82%', icon: 'üß†', color: 'purple' }
                                        ].map((metric, idx) =>
                                            h('div', {
                                                key: idx,
                                                className: 'text-center p-3 bg-white rounded border'
                                            },
                                                h('div', { className: 'text-2xl mb-1' }, metric.icon),
                                                h('div', { className: `text-lg font-bold text-${metric.color}-600` }, metric.value),
                                                h('div', { className: 'text-xs text-gray-600' }, metric.label)
                                            )
                                        )
                                    )
                                )
                            )
                        ),

                        // Achievements System View
                        currentView === 'achievements' && h('div', { className: 'space-y-6 fade-in' },
                            h('div', { className: 'bg-white rounded-xl shadow-sm p-6' },
                                h('div', { className: 'flex justify-between items-center mb-6' },
                                    h('div', null,
                                        h('div', { className: 'flex items-center gap-3 mb-2' },
                                            h('h2', { className: 'text-2xl font-bold' }, 'Achievement System'),
                                            h(Phase3Badge)
                                        ),
                                        h('p', { className: 'text-gray-600' }, 
                                            'Manage badges, milestones, and user recognition'
                                        )
                                    ),
                                    h('button', {
                                        onClick: () => showToast('Achievement builder coming soon!', 'info'),
                                        className: 'px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700'
                                    }, '+ Create Achievement')
                                ),

                                // Achievement Categories
                                h('div', { className: 'grid md:grid-cols-3 gap-6 mb-6' },
                                    // Learning Achievements
                                    h('div', { className: 'border rounded-lg p-4 bg-gradient-to-br from-yellow-50 to-orange-50' },
                                        h('h3', { className: 'font-semibold mb-3 flex items-center gap-2' },
                                            h('span', null, 'üéì'),
                                            'Learning Milestones',
                                            h('span', { className: 'px-2 py-1 bg-yellow-100 text-yellow-700 text-xs rounded-full' }, '4 Active')
                                        ),
                                        h('div', { className: 'space-y-2' },
                                            [
                                                { name: 'First Steps', desc: 'Complete first module', icon: 'üë£', earned: 23 },
                                                { name: 'Foundation Complete', desc: 'Finish all 5 foundation modules', icon: 'üèóÔ∏è', earned: 8 },
                                                { name: 'Study Streak', desc: '7 days of study activity', icon: 'üî•', earned: 12 },
                                                { name: 'Expert Level', desc: '90%+ accuracy over 50 questions', icon: 'üëë', earned: 3 }
                                            ].map((achievement, idx) =>
                                                h('div', {
                                                    key: idx,
                                                    className: 'flex items-center gap-3 p-3 bg-white rounded border hover:shadow-sm transition-shadow'
                                                },
                                                    h('span', { className: 'text-2xl' }, achievement.icon),
                                                    h('div', { className: 'flex-1' },
                                                        h('div', { className: 'font-medium text-sm' }, achievement.name),
                                                        h('div', { className: 'text-xs text-gray-600' }, achievement.desc)
                                                    ),
                                                    h('div', { className: 'text-right' },
                                                        h('div', { className: 'text-sm font-bold text-yellow-600' }, achievement.earned),
                                                        h('div', { className: 'text-xs text-gray-500' }, 'earned')
                                                    )
                                                )
                                            )
                                        )
                                    ),

                                    // Identification Achievements
                                    h('div', { className: 'border rounded-lg p-4 bg-gradient-to-br from-green-50 to-emerald-50' },
                                        h('h3', { className: 'font-semibold mb-3 flex items-center gap-2' },
                                            h('span', null, 'üçÑ'),
                                            'ID Skills',
                                            h('span', { className: 'px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full' }, '5 Active')
                                        ),
                                        h('div', { className: 'space-y-2' },
                                            [
                                                { name: 'Family Expert', desc: 'Master a fungal family', icon: 'üè†', earned: 5 },
                                                { name: 'DNA Detective', desc: 'ID 10 DNA-verified specimens', icon: 'üß¨', earned: 7 },
                                                { name: 'Arizona Native', desc: 'Know 25 local species', icon: 'üåµ', earned: 2 },
                                                { name: 'Hint Master', desc: 'Answer without hints 20 times', icon: 'üí°', earned: 9 }
                                            ].map((achievement, idx) =>
                                                h('div', {
                                                    key: idx,
                                                    className: 'flex items-center gap-3 p-3 bg-white rounded border hover:shadow-sm transition-shadow'
                                                },
                                                    h('span', { className: 'text-2xl' }, achievement.icon),
                                                    h('div', { className: 'flex-1' },
                                                        h('div', { className: 'font-medium text-sm' }, achievement.name),
                                                        h('div', { className: 'text-xs text-gray-600' }, achievement.desc)
                                                    ),
                                                    h('div', { className: 'text-right' },
                                                        h('div', { className: 'text-sm font-bold text-green-600' }, achievement.earned),
                                                        h('div', { className: 'text-xs text-gray-500' }, 'earned')
                                                    )
                                                )
                                            )
                                        )
                                    ),

                                    // Future Achievements
                                    h('div', { className: 'border-2 border-dashed border-purple-300 rounded-lg p-4 bg-gradient-to-br from-purple-50 to-pink-50' },
                                        h('h3', { className: 'font-semibold mb-3 flex items-center gap-2' },
                                            h('span', null, 'üë•'),
                                            'Community',
                                            h('span', { className: 'px-2 py-1 bg-purple-100 text-purple-700 text-xs rounded-full' }, 'Coming')
                                        ),
                                        h('div', { className: 'space-y-2 text-sm text-purple-700' },
                                            h('div', { className: 'flex items-center gap-2' },
                                                h('span', null, 'üèÜ'),
                                                'Mentor Badge'
                                            ),
                                            h('div', { className: 'flex items-center gap-2' },
                                                h('span', null, '‚≠ê'),
                                                'Top Contributor'
                                            ),
                                            h('div', { className: 'flex items-center gap-2' },
                                                h('span', null, 'üåü'),
                                                'Expert Reviewer'
                                            ),
                                            h('div', { className: 'flex items-center gap-2' },
                                                h('span', null, 'üëë'),
                                                'Community Leader'
                                            )
                                        ),
                                        h('div', { className: 'mt-3 p-2 bg-purple-100 rounded text-center' },
                                            h('p', { className: 'text-xs text-purple-700 font-medium' }, 
                                                'Social features in development'
                                            )
                                        )
                                    )
                                ),

                                // Achievement Impact Analytics
                                h('div', { className: 'bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-4 border border-purple-200' },
                                    h('h4', { className: 'font-semibold mb-3 flex items-center gap-2' },
                                        h('span', null, 'üèÜ'),
                                        'Achievement Impact & Engagement'
                                    ),
                                    h('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-4' },
                                        [
                                            { label: 'Total Earned', value: '127', desc: 'All achievements', color: 'purple' },
                                            { label: 'Avg per User', value: '2.8', desc: 'User engagement', color: 'blue' },
                                            { label: 'Completion Rate', value: '73%', desc: 'First milestone', color: 'green' },
                                            { label: 'Motivation Score', value: '+34%', desc: 'Return visits', color: 'orange' }
                                        ].map((metric, idx) =>
                                            h('div', {
                                                key: idx,
                                                className: 'text-center p-3 bg-white rounded border'
                                            },
                                                h('div', { className: `text-xl font-bold text-${metric.color}-600` }, metric.value),
                                                h('div', { className: 'text-sm font-medium' }, metric.label),
                                                h('div', { className: 'text-xs text-gray-600' }, metric.desc)
                                            )
                                        )
                                    )
                                )
                            )
                        ),

                        // User Analytics Dashboard
                        currentView === 'user-analytics' && h('div', { className: 'space-y-6 fade-in' },
                            h('div', { className: 'bg-white rounded-xl shadow-sm p-6' },
                                h('div', { className: 'flex justify-between items-center mb-6' },
                                    h('div', null,
                                        h('div', { className: 'flex items-center gap-3 mb-2' },
                                            h('h2', { className: 'text-2xl font-bold' }, 'User Analytics Dashboard'),
                                            h(Phase3Badge)
                                        ),
                                        h('p', { className: 'text-gray-600' }, 
                                            'Learning progress and platform engagement insights'
                                        )
                                    ),
                                    h('div', { className: 'flex gap-2' },
                                        h('select', {
                                            className: 'px-3 py-2 border rounded-lg text-sm'
                                        },
                                            h('option', null, 'Last 7 days'),
                                            h('option', null, 'Last 30 days'),
                                            h('option', null, 'All time')
                                        ),
                                        h('button', {
                                            onClick: () => showToast('Analytics export feature coming soon!', 'info'),
                                            className: 'px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm'
                                        }, 'Export Data')
                                    )
                                ),

                                // Key Performance Indicators
                                h('div', { className: 'grid md:grid-cols-4 gap-6 mb-6' },
                                    [
                                        { label: 'Active Learners', value: '47', change: '+23%', trend: 'up', color: 'green', icon: 'üë•' },
                                        { label: 'Study Sessions', value: '284', change: '+18%', trend: 'up', color: 'blue', icon: 'üìñ' },
                                        { label: 'Avg Accuracy', value: '76%', change: '+8%', trend: 'up', color: 'purple', icon: 'üéØ' },
                                        { label: 'Retention Rate', value: '68%', change: '+5%', trend: 'up', color: 'orange', icon: 'üîÑ' }
                                    ].map((kpi, idx) =>
                                        h('div', {
                                            key: idx,
                                            className: 'bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg p-4 border'
                                        },
                                            h('div', { className: 'flex justify-between items-start mb-3' },
                                                h('span', { className: 'text-2xl' }, kpi.icon),
                                                h('span', { 
                                                    className: `text-xs px-2 py-1 rounded font-medium ${
                                                        kpi.trend === 'up' 
                                                            ? `text-${kpi.color}-700 bg-${kpi.color}-100` 
                                                            : 'text-red-700 bg-red-100'
                                                    }`
                                                }, kpi.change)
                                            ),
                                            h('div', { className: `text-2xl font-bold text-${kpi.color}-600 mb-1` }, kpi.value),
                                            h('div', { className: 'text-sm text-gray-600' }, kpi.label)
                                        )
                                    )
                                ),

                                // Learning Progress Visualization
                                h('div', { className: 'grid md:grid-cols-2 gap-6 mb-6' },
                                    // Module Completion Tracking
                                    h('div', { className: 'border rounded-lg p-4 bg-gradient-to-br from-blue-50 to-indigo-50' },
                                        h('h3', { className: 'font-semibold mb-4 flex items-center gap-2' },
                                            h('span', null, 'üìö'),
                                            'Module Completion Analytics'
                                        ),
                                        h('div', { className: 'space-y-4' },
                                            [
                                                { name: 'Basic Diagnostic Features', completion: 89, users: 42, difficulty: 'Beginner' },
                                                { name: 'Spore Print Basics', completion: 76, users: 36, difficulty: 'Beginner' },
                                                { name: 'Safety: Deadly Species', completion: 94, users: 44, difficulty: 'Critical' },
                                                { name: 'Mycological Terminology', completion: 67, users: 32, difficulty: 'Intermediate' },
                                                { name: 'Arizona Fungal Families', completion: 58, users: 27, difficulty: 'Intermediate' }
                                            ].map((module, idx) =>
                                                h('div', { key: idx, className: 'bg-white rounded p-3 border' },
                                                    h('div', { className: 'flex justify-between items-center mb-2' },
                                                        h('span', { className: 'font-medium text-sm' }, module.name),
                                                        h('div', { className: 'flex items-center gap-2' },
                                                            h('span', { 
                                                                className: `text-xs px-2 py-1 rounded ${
                                                                    module.difficulty === 'Critical' ? 'bg-red-100 text-red-700' :
                                                                    module.difficulty === 'Intermediate' ? 'bg-yellow-100 text-yellow-700' :
                                                                    'bg-green-100 text-green-700'
                                                                }`
                                                            }, module.difficulty),
                                                            h('span', { className: 'text-xs text-gray-600' }, `${module.users} users`)
                                                        )
                                                    ),
                                                    h('div', { className: 'w-full bg-gray-200 rounded-full h-2' },
                                                        h('div', {
                                                            className: `h-2 rounded-full ${
                                                                module.completion >= 80 ? 'bg-green-500' :
                                                                module.completion >= 60 ? 'bg-yellow-500' : 'bg-red-500'
                                                            }`,
                                                            style: { width: `${module.completion}%` }
                                                        })
                                                    ),
                                                    h('div', { className: 'text-xs text-gray-500 mt-1' }, 
                                                        `${module.completion}% completion rate`
                                                    )
                                                )
                                            )
                                        )
                                    ),

                                    // User Engagement Insights
                                    h('div', { className: 'border rounded-lg p-4 bg-gradient-to-br from-green-50 to-emerald-50' },
                                        h('h3', { className: 'font-semibold mb-4 flex items-center gap-2' },
                                            h('span', null, 'üìä'),
                                            'Engagement Patterns'
                                        ),
                                        h('div', { className: 'space-y-4' },
                                            h('div', { className: 'bg-white rounded p-3 border' },
                                                h('div', { className: 'flex justify-between items-center mb-2' },
                                                    h('span', { className: 'font-medium text-green-800' }, 'Peak Learning Time'),
                                                    h('span', { className: 'text-green-600 font-bold' }, '7-9 PM')
                                                ),
                                                h('div', { className: 'text-sm text-green-700' }, 
                                                    'Most active study period for users'
                                                )
                                            ),
                                            h('div', { className: 'bg-white rounded p-3 border' },
                                                h('div', { className: 'flex justify-between items-center mb-2' },
                                                    h('span', { className: 'font-medium text-blue-800' }, 'Session Duration'),
                                                    h('span', { className: 'text-blue-600 font-bold' }, '12.4 min')
                                                ),
                                                h('div', { className: 'text-sm text-blue-700' }, 
                                                    'Average study session length'
                                                )
                                            ),
                                            h('div', { className: 'bg-white rounded p-3 border' },
                                                h('div', { className: 'flex justify-between items-center mb-2' },
                                                    h('span', { className: 'font-medium text-purple-800' }, 'Weekly Retention'),
                                                    h('span', { className: 'text-purple-600 font-bold' }, '72%')
                                                ),
                                                h('div', { className: 'text-sm text-purple-700' }, 
                                                    'Users return within 7 days'
                                                )
                                            ),
                                            h('div', { className: 'bg-white rounded p-3 border' },
                                                h('div', { className: 'flex justify-between items-center mb-2' },
                                                    h('span', { className: 'font-medium text-orange-800' }, 'Mobile Usage'),
                                                    h('span', { className: 'text-orange-600 font-bold' }, '43%')
                                                ),
                                                h('div', { className: 'text-sm text-orange-700' }, 
                                                    'Access via mobile devices'
                                                )
                                            )
                                        )
                                    )
                                ),

                                // Advanced Analytics Section
                                h('div', { className: 'bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-6 border border-indigo-200' },
                                    h('h4', { className: 'font-semibold mb-4 flex items-center gap-2' },
                                        h('span', null, 'üî¨'),
                                        'Advanced Learning Analytics'
                                    ),
                                    h('div', { className: 'grid md:grid-cols-3 gap-4' },
                                        h('div', { className: 'bg-white rounded p-4 border' },
                                            h('h5', { className: 'font-medium mb-2 text-indigo-800' }, 'Learning Efficiency'),
                                            h('div', { className: 'text-2xl font-bold text-indigo-600 mb-1' }, '2.3x'),
                                            h('div', { className: 'text-sm text-gray-600' }, 'Faster improvement with hints'),
                                            h('div', { className: 'text-xs text-indigo-600 mt-2' }, 'vs traditional methods')
                                        ),
                                        h('div', { className: 'bg-white rounded p-4 border' },
                                            h('h5', { className: 'font-medium mb-2 text-purple-800' }, 'Knowledge Retention'),
                                            h('div', { className: 'text-2xl font-bold text-purple-600 mb-1' }, '85%'),
                                            h('div', { className: 'text-sm text-gray-600' }, 'After 30 days'),
                                            h('div', { className: 'text-xs text-purple-600 mt-2' }, 'High retention rate')
                                        ),
                                        h('div', { className: 'bg-white rounded p-4 border' },
                                            h('h5', { className: 'font-medium mb-2 text-pink-800' }, 'Difficulty Adaptation'),
                                            h('div', { className: 'text-2xl font-bold text-pink-600 mb-1' }, '94%'),
                                            h('div', { className: 'text-sm text-gray-600' }, 'Optimal challenge level'),
                                            h('div', { className: 'text-xs text-pink-600 mt-2' }, 'AI-powered adjustment')
                                        )
                                    )
                                )
                            )
                        ),

                        // Review Queue (Existing functionality preserved)
                        currentView === 'review' && h('div', { className: 'space-y-6 fade-in' },
                            h('div', { className: 'bg-white rounded-xl shadow-sm p-6' },
                                h('h2', { className: 'text-2xl font-bold mb-6' }, 'Review Queue'),
                                stats.pending === 0 ?
                                    h('div', { className: 'text-center py-12' },
                                        h('div', { className: 'text-6xl mb-4' }, 'üéâ'),
                                        h('h3', { className: 'text-2xl font-bold mb-2' }, 'All Caught Up!'),
                                        h('p', { className: 'text-gray-600' }, 'No specimens pending review.')
                                    ) :
                                    h('div', { className: 'grid gap-4' },
                                        filteredSpecimens
                                            .filter(s => s.status === 'pending')
                                            .map(specimen =>
                                                h('div', {
                                                    key: specimen.id,
                                                    className: 'border rounded-lg p-4 hover:shadow-md transition-shadow'
                                                },
                                                    h('div', { className: 'flex justify-between items-start' },
                                                        h('div', { className: 'flex-1' },
                                                            h('h3', { className: 'text-lg font-semibold' }, specimen.species_name),
                                                            h('p', { className: 'text-gray-600' }, specimen.common_name || 'No common name'),
                                                            h('div', { className: 'flex items-center gap-4 mt-2 text-sm text-gray-500' },
                                                                h('span', null, `üìç ${specimen.location}`),
                                                                specimen.dna_sequenced && h('span', { className: 'text-purple-600 font-medium' }, 'üß¨ DNA')
                                                            )
                                                        ),
                                                        h('button', {
                                                            onClick: () => setSelectedSpecimen(specimen),
                                                            className: 'px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700'
                                                        }, 'Review')
                                                    )
                                                )
                                            )
                                    )
                            )
                        ),

                        // Field Guide Pages View (Existing functionality preserved)
                        currentView === 'field-guides' && h('div', { className: 'space-y-6 fade-in' },
                            h('div', { className: 'bg-white rounded-xl shadow-sm p-6' },
                                h('div', { className: 'flex justify-between items-center mb-6' },
                                    h('div', null,
                                        h('h2', { className: 'text-2xl font-bold' }, 'Field Guide Pages'),
                                        h('p', { className: 'text-gray-600' }, 
                                            `${stats.guidesComplete} of ${stats.uniqueSpecies} species have field guides`
                                        )
                                    ),
                                    h('input', {
                                        type: 'text',
                                        value: searchTerm,
                                        onChange: (e) => setSearchTerm(e.target.value),
                                        placeholder: 'Search species...',
                                        className: 'px-3 py-2 border rounded-lg'
                                    })
                                ),

                                h('div', { className: 'grid gap-4' },
                                    uniqueSpeciesList
                                        .filter(species => 
                                            !searchTerm || 
                                            species.species_name.toLowerCase().includes(searchTerm.toLowerCase())
                                        )
                                        .map(species => {
                                            const hasGuide = species.hints && species.hints.length > 0;
                                            const specimenCount = species.specimens.length;
                                            const photoCount = species.reference_photos ? species.reference_photos.length : 0;
                                            
                                            return h('div', {
                                                key: species.species_name,
                                                className: `border rounded-lg p-4 ${hasGuide ? 'border-gray-200' : 'border-orange-300 bg-orange-50'}`
                                            },
                                                h('div', { className: 'flex justify-between items-start' },
                                                    h('div', { className: 'flex-1' },
                                                        h('h3', { className: 'text-lg font-semibold' }, species.species_name),
                                                        h('p', { className: 'text-gray-600' }, 
                                                            species.common_name || `Family: ${species.family}`
                                                        ),
                                                        h('div', { className: 'flex items-center gap-4 mt-2' },
                                                            h('span', { className: 'text-sm text-gray-500' }, 
                                                                `${specimenCount} specimen${specimenCount !== 1 ? 's' : ''}`
                                                            ),
                                                            photoCount > 0 && h('span', { className: 'text-sm text-blue-600' }, 
                                                                `üì∏ ${photoCount} photos`
                                                            ),
                                                            hasGuide && h('span', { 
                                                                className: 'text-sm bg-green-100 text-green-800 px-2 py-1 rounded'
                                                            }, '‚úì Has Guide')
                                                        )
                                                    ),
                                                    h('button', {
                                                        onClick: () => setSelectedSpecies(species),
                                                        className: `px-4 py-2 rounded-lg text-white ${
                                                            hasGuide 
                                                                ? 'bg-blue-600 hover:bg-blue-700' 
                                                                : 'bg-green-600 hover:bg-green-700'
                                                        }`
                                                    }, hasGuide ? 'Edit Guide' : 'Create Guide')
                                                )
                                            );
                                        })
                                )
                            )
                        ),

                        // All Specimens View (Existing functionality preserved)
                        currentView === 'specimens' && h('div', { className: 'space-y-6 fade-in' },
                            h('div', { className: 'bg-white rounded-xl shadow-sm p-6' },
                                h('div', { className: 'flex justify-between items-center mb-6' },
                                    h('h2', { className: 'text-2xl font-bold' }, 'All Specimens'),
                                    h('div', { className: 'flex items-center gap-4' },
                                        h('select', {
                                            value: filterStatus,
                                            onChange: (e) => setFilterStatus(e.target.value),
                                            className: 'px-3 py-2 border rounded-lg'
                                        },
                                            h('option', { value: 'all' }, 'All Status'),
                                            h('option', { value: 'pending' }, 'Pending'),
                                            h('option', { value: 'approved' }, 'Approved')
                                        ),
                                        h('input', {
                                            type: 'text',
                                            value: searchTerm,
                                            onChange: (e) => setSearchTerm(e.target.value),
                                            placeholder: 'Search specimens...',
                                            className: 'px-3 py-2 border rounded-lg'
                                        })
                                    )
                                ),

                                h('div', { className: 'overflow-x-auto' },
                                    h('table', { className: 'w-full' },
                                        h('thead', null,
                                            h('tr', { className: 'border-b' },
                                                h('th', { className: 'text-left p-3' }, 'Species'),
                                                h('th', { className: 'text-left p-3' }, 'Location'),
                                                h('th', { className: 'text-center p-3' }, 'DNA'),
                                                h('th', { className: 'text-center p-3' }, 'Status'),
                                                h('th', { className: 'text-center p-3' }, 'Actions')
                                            )
                                        ),
                                        h('tbody', null,
                                            filteredSpecimens.map(specimen =>
                                                h('tr', {
                                                    key: specimen.id,
                                                    className: 'border-b hover:bg-gray-50'
                                                },
                                                    h('td', { className: 'p-3' },
                                                        h('div', null,
                                                            h('div', { className: 'font-medium' }, specimen.species_name),
                                                            h('div', { className: 'text-sm text-gray-600' }, specimen.common_name)
                                                        )
                                                    ),
                                                    h('td', { className: 'p-3 text-sm' }, specimen.location),
                                                    h('td', { className: 'p-3 text-center' },
                                                        specimen.dna_sequenced ? 
                                                            h('span', { className: 'text-purple-600' }, 'üß¨') : 
                                                            h('span', { className: 'text-gray-400' }, '‚Äî')
                                                    ),
                                                    h('td', { className: 'p-3 text-center' },
                                                        h('span', {
                                                            className: `px-2 py-1 rounded text-xs font-medium ${
                                                                specimen.status === 'approved' 
                                                                    ? 'bg-green-100 text-green-800' 
                                                                    : 'bg-orange-100 text-orange-800'
                                                            }`
                                                        }, specimen.status)
                                                    ),
                                                    h('td', { className: 'p-3 text-center' },
                                                        h('button', {
                                                            onClick: () => setSelectedSpecimen(specimen),
                                                            className: 'text-blue-600 hover:text-blue-800'
                                                        }, 'üëÅÔ∏è')
                                                    )
                                                )
                                            )
                                        )
                                    )
                                )
                            )
                        )
                    ),

                    // Modals
                    selectedSpecimen && h(SpecimenReviewModal, {
                        specimen: selectedSpecimen,
                        onClose: () => setSelectedSpecimen(null),
                        onApprove: handleApproveSpecimen,
                        onDelete: handleDeleteSpecimen
                    }),

                    selectedSpecies && h(FieldGuideEditor, {
                        species: selectedSpecies,
                        specimens: specimens,
                        allPhotos: getAllPhotosForSpecies(selectedSpecies.species_name),
                        onClose: () => setSelectedSpecies(null),
                        onSave: handleSaveFieldGuide
                    }),

                    selectedModule && h(ModuleContentEditor, {
                        module: selectedModule,
                        onSave: (content) => {
                            showToast('Module content saved successfully', 'success');
                            setSelectedModule(null);
                        },
                        onClose: () => setSelectedModule(null)
                    }),

                    // Toast Notifications
                    toast && h(Toast, {
                        message: toast.message,
                        type: toast.type,
                        onClose: () => setToast(null)
                    })
                );
            }

            // Render the app
            try {
                const root = ReactDOM.createRoot(document.getElementById('admin-root'));
                root.render(h(AdminPortal));
                console.log('‚úÖ Enhanced Admin portal with Phase 3 features initialized successfully');
            } catch (error) {
                console.error('‚ùå Error rendering admin portal:', error);
            }
        }
    </script>
</body>
</html>